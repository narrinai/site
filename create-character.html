<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create AI Character | Custom Character Builder - Narrin AI</title>
  <meta name="description" content="Create your own AI character with custom personality, appearance, and behavior. Build unique AI companions for chat with our easy character creation tool.">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  
  <!-- Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  
  <!-- Import Modern Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    /* ===== CSS CUSTOM PROPERTIES ===== */
    :root {
      /* Primary Colors */
      --color-white: #ffffff;
      --color-off-white: #fafafa;
      --color-light-gray: #f5f5f5;
      
      /* Accent Colors */
      --color-teal: #14b8a6;
      --color-teal-light: #5eead4;
      --color-teal-dark: #0f766e;
      --color-teal-alt: #10a394;
      --color-coral: #f97316;
      --color-coral-light: #fb923c;
      --color-coral-dark: #ea580c;
      
      /* Supporting Colors */
      --color-navy: #1e293b;
      --color-navy-light: #334155;
      --color-gray: #64748b;
      --color-gray-light: #94a3b8;
      --color-gray-dark: #475569;
      
      /* Gradients */
      --gradient-primary: linear-gradient(135deg, var(--color-teal) 0%, var(--color-coral) 100%);
      --gradient-subtle: linear-gradient(135deg, var(--color-teal-light) 0%, var(--color-coral-light) 100%);
      --gradient-tags: linear-gradient(135deg, var(--color-teal-alt) 0%, var(--color-coral) 100%);
      
      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --shadow-colored: 0 10px 25px -5px rgba(20, 184, 166, 0.2);
      
      /* Spacing */
      --spacing-xs: 0.5rem;
      --spacing-sm: 0.75rem;
      --spacing-md: 1rem;
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
      --spacing-2xl: 3rem;
      --spacing-3xl: 4rem;
      
      /* Typography */
      --font-primary: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      --font-secondary: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
      
      /* Font Sizes */
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-2xl: 1.5rem;
      --font-size-3xl: 1.875rem;
      --font-size-4xl: 2.25rem;
      
      /* Border Radius */
      --radius-sm: 6px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 9999px;
      
      /* Transitions */
      --transition-fast: 150ms ease-out;
      --transition-base: 300ms ease-out;
      --transition-slow: 500ms ease-out;
      
      /* Touch Target Size */
      --touch-target: 44px;
      
      /* Z-index Scale */
      --z-dropdown: 100;
      --z-sticky: 200;
      --z-overlay: 300;
      --z-modal: 400;
      --z-menu-overlay: 500;
    }

    /* ===== RESET & BASE STYLES ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      overflow-x: hidden;
    }

    body {
      font-family: var(--font-primary);
      background: var(--color-off-white);
      color: var(--color-navy);
      line-height: 1.6;
      font-size: var(--font-size-base);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
      width: 100%;
    }

    input, button, textarea, select {
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      z-index: 10;
      position: relative;
    }

    /* ===== ACCESSIBILITY ===== */
    :focus {
      outline: 2px solid var(--color-teal);
      outline-offset: 2px;
    }

    :focus:not(:focus-visible) {
      outline: none;
    }

    /* ===== HEADER NAVIGATION ===== */
    .header {
      position: sticky;
      top: 0;
      z-index: var(--z-sticky);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      transition: all var(--transition-base);
    }

    .header-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 var(--spacing-lg);
      width: 100%;
      overflow: hidden;
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 72px;
      gap: var(--spacing-lg);
      width: 100%;
    }

    /* Logo */
    .logo {
      font-family: var(--font-secondary);
      font-size: var(--font-size-xl);
      font-weight: 800;
      text-decoration: none;
      letter-spacing: -0.02em;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      transition: transform var(--transition-base);
      flex-shrink: 0;
    }

    .logo:hover {
      transform: scale(1.05);
    }

    /* Desktop Navigation Center */
    .nav-center {
      display: none;
      align-items: center;
      gap: var(--spacing-2xl);
      flex: 1;
      justify-content: center;
    }

    /* USPs Container - Desktop */
    .nav-usps {
      display: flex;
      align-items: center;
      gap: var(--spacing-xl);
    }

    .usp-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      color: var(--color-gray-dark);
      font-size: var(--font-size-xs);
      font-weight: 500;
      white-space: nowrap;
    }

    .usp-icon {
      font-size: var(--font-size-lg);
      color: var(--color-teal);
    }

    /* Search Bar - Desktop */
    .nav-search {
      position: relative;
      width: 100%;
      max-width: 400px;
    }

    .nav-search-input {
      width: 100%;
      padding: var(--spacing-sm) var(--spacing-lg);
      padding-right: calc(var(--spacing-lg) * 2.5);
      font-size: var(--font-size-sm);
      font-family: inherit;
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-full);
      background: var(--color-white);
      color: var(--color-navy);
      transition: all var(--transition-base);
    }

    .nav-search-input:hover {
      border-color: var(--color-gray-light);
    }

    .nav-search-input:focus {
      border-color: var(--color-teal);
      box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
    }

    .nav-search-input::placeholder {
      color: var(--color-gray-light);
    }

    .search-submit {
      position: absolute;
      right: 6px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--gradient-primary);
      border: none;
      border-radius: var(--radius-full);
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .search-submit:hover {
      transform: translateY(-50%) scale(1.1);
    }

    .search-submit svg {
      width: 18px;
      height: 18px;
      color: var(--color-white);
    }

    /* Navigation Links - Desktop */
    .nav-links {
      display: none;
      align-items: center;
      gap: var(--spacing-xl);
    }

    .nav-link {
      color: var(--color-navy);
      text-decoration: none;
      font-weight: 500;
      font-size: var(--font-size-sm);
      transition: color var(--transition-base);
      position: relative;
      padding: var(--spacing-xs) 0;
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--gradient-primary);
      transition: width var(--transition-base);
    }

    .nav-link:hover {
      color: var(--color-teal);
    }

    .nav-link:hover::after {
      width: 100%;
    }

    /* Buttons - Fixed to match profile.html exactly */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-sm) var(--spacing-lg);
      font-size: var(--font-size-sm);
      font-weight: 600;
      text-decoration: none;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-base);
      min-height: var(--touch-target);
      white-space: nowrap;
      font-family: var(--font-primary);
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: var(--color-white);
      box-shadow: var(--shadow-colored);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    /* Mobile Navigation Container */
    .mobile-nav-container {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      flex-shrink: 0;
    }

    /* Mobile USP Carousel */
    .mobile-usp-carousel {
      display: none;
      align-items: center;
      justify-content: center;
      height: 24px;
      overflow: hidden;
      position: relative;
      flex: 1;
      min-width: 0;
    }

    .mobile-usp-track {
      display: flex;
      flex-direction: column;
      transition: transform var(--transition-slow);
      height: 300%;
    }

    .mobile-usp-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      color: var(--color-gray-dark);
      font-size: var(--font-size-xs);
      font-weight: 500;
      white-space: nowrap;
      min-height: 100%;
      justify-content: center;
      flex-shrink: 0;
    }

    /* Mobile Search Button */
    .mobile-search-btn {
      display: none;
      align-items: center;
      justify-content: center;
      width: var(--touch-target);
      height: var(--touch-target);
      background: transparent;
      border: none;
      cursor: pointer;
      color: var(--color-navy);
      transition: all var(--transition-base);
      border-radius: var(--radius-md);
      flex-shrink: 0;
    }

    .mobile-search-btn:hover {
      background: var(--color-light-gray);
    }

    .mobile-search-btn svg {
      width: 24px;
      height: 24px;
    }

    /* Mobile Hamburger Menu */
    .mobile-menu-btn {
      display: none;
      align-items: center;
      justify-content: center;
      width: var(--touch-target);
      height: var(--touch-target);
      background: transparent;
      border: none;
      cursor: pointer;
      color: var(--color-navy);
      transition: all var(--transition-base);
      border-radius: var(--radius-md);
      position: relative;
      flex-shrink: 0;
      z-index: var(--z-menu-overlay);
    }

    .mobile-menu-btn:hover {
      background: var(--color-light-gray);
    }

    .hamburger {
      width: 24px;
      height: 18px;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .hamburger span {
      display: block;
      height: 2px;
      width: 100%;
      background: var(--color-navy);
      border-radius: 1px;
      transition: all var(--transition-base);
    }

    .mobile-menu-btn.active .hamburger span:nth-child(1) {
      transform: rotate(45deg) translate(6px, 6px);
    }

    .mobile-menu-btn.active .hamburger span:nth-child(2) {
      opacity: 0;
    }

    .mobile-menu-btn.active .hamburger span:nth-child(3) {
      transform: rotate(-45deg) translate(6px, -6px);
    }

    /* Mobile Menu Overlay - Full Screen */
    .mobile-menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(30, 41, 59, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      z-index: var(--z-overlay);
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-base);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .mobile-menu-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .mobile-menu-content {
      background: var(--color-white);
      border-radius: var(--radius-xl);
      padding: var(--spacing-3xl) var(--spacing-xl);
      box-shadow: var(--shadow-xl);
      max-width: 90vw;
      width: 100%;
      max-width: 400px;
      transform: scale(0.9) translateY(20px);
      transition: all var(--transition-base);
    }

    .mobile-menu-overlay.active .mobile-menu-content {
      transform: scale(1) translateY(0);
    }

    .mobile-menu-header {
      text-align: center;
      margin-bottom: var(--spacing-2xl);
    }

    .mobile-menu-logo {
      font-family: var(--font-secondary);
      font-size: var(--font-size-2xl);
      font-weight: 800;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: var(--spacing-sm);
    }

    .mobile-menu-subtitle {
      color: var(--color-gray);
      font-size: var(--font-size-sm);
    }

    .mobile-menu-nav {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }

    .mobile-menu-link {
      display: flex;
      align-items: center;
      padding: var(--spacing-md) var(--spacing-lg);
      color: var(--color-navy);
      text-decoration: none;
      font-weight: 500;
      font-size: var(--font-size-base);
      transition: all var(--transition-base);
      border-radius: var(--radius-md);
      background: var(--color-off-white);
      font-family: var(--font-primary);
    }

    .mobile-menu-link:hover {
      background: var(--color-light-gray);
      color: var(--color-teal);
      transform: translateX(4px);
    }

    .mobile-menu-link.btn-primary {
      background: var(--gradient-primary);
      color: var(--color-white);
      justify-content: center;
      font-weight: 700;
      margin-top: var(--spacing-lg);
    }

    .mobile-menu-link.btn-primary:hover {
      background: var(--gradient-primary);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .mobile-menu-link-icon {
      margin-right: var(--spacing-sm);
      font-size: var(--font-size-lg);
    }

    /* Mobile Search Overlay */
    .mobile-search-overlay {
      position: fixed;
      top: 72px;
      left: 0;
      right: 0;
      background: var(--color-white);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-lg);
      transform: translateY(-100%);
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-base);
      z-index: var(--z-dropdown);
    }

    .mobile-search-overlay.active {
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
    }

    .mobile-search-form {
      display: flex;
      gap: var(--spacing-sm);
    }

    .mobile-search-input {
      flex: 1;
      padding: var(--spacing-md);
      font-size: var(--font-size-base);
      font-family: inherit;
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-md);
      background: var(--color-white);
      color: var(--color-navy);
      transition: all var(--transition-base);
    }

    .mobile-search-input:focus {
      border-color: var(--color-teal);
      box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
    }

    /* Desktop Styles */
    @media (min-width: 769px) {
      .nav-center {
        display: flex;
      }

      .nav-links {
        display: flex;
      }

      .mobile-nav-container {
        display: none;
      }

      .mobile-usp-carousel {
        display: none !important;
      }

      .mobile-search-btn {
        display: none !important;
      }

      #desktopSearchBtn {
        display: flex !important;
      }

      .mobile-menu-btn {
        display: none !important;
      }

      .mobile-menu-overlay {
        display: none !important;
      }
    }

    /* Mobile Styles */
    @media (max-width: 768px) {
      .header-container {
        padding: 0 var(--spacing-md);
      }

      .header-content {
        min-height: 60px;
        gap: var(--spacing-sm);
        padding: 0;
        display: grid;
        grid-template-columns: auto 1fr auto auto;
        align-items: center;
      }

      .logo {
        font-size: var(--font-size-lg);
        flex-shrink: 0;
        min-width: fit-content;
        grid-column: 1;
      }

      .mobile-usp-carousel {
        display: flex;
        height: 24px;
        overflow: hidden;
        position: relative;
        grid-column: 2;
        justify-self: center;
        align-items: center;
        justify-content: center;
      }

      .mobile-nav-container {
        flex-shrink: 0;
        min-width: fit-content;
        display: flex !important;
        gap: var(--spacing-xs);
        grid-column: 3 / 5;
        justify-self: end;
      }

      .nav-center {
        display: none !important;
      }

      .nav-links {
        display: none !important;
      }

      .mobile-search-btn {
        display: flex;
        flex-shrink: 0;
      }

      .mobile-menu-btn {
        display: flex;
        flex-shrink: 0;
      }

      .mobile-search-overlay {
        top: 60px;
      }
    }

    /* Extra small mobile devices */
    @media (max-width: 480px) {
      .header-content {
        gap: 4px;
        grid-template-columns: auto 1fr auto auto;
      }
      
      .logo {
        font-size: var(--font-size-base);
      }

      .mobile-usp-carousel {
        margin: 0 4px;
      }

      .mobile-nav-container {
        gap: 4px;
      }
    }

    /* Netlify Identity Modal Positioning - Fixed for mobile and desktop */
    .netlify-identity-widget,
    [data-netlify-identity-widget] {
      z-index: 1001 !important;
    }

    .netlify-identity-widget iframe,
    .netlify-identity-widget > div,
    .netlify-identity-widget .netlify-identity-modal {
      z-index: 1001 !important;
    }

    /* Force modal to appear below header on mobile */
    @media (max-width: 768px) {
      .netlify-identity-widget {
        position: fixed !important;
        top: 80px !important; /* Below header */
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        z-index: 1001 !important;
      }
      
      .netlify-identity-widget > div {
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        z-index: 1001 !important;
        margin: 0 !important;
        padding: 20px !important;
        box-sizing: border-box !important;
      }

      .netlify-identity-widget .netlify-identity-modal {
        position: relative !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        max-width: none !important;
        margin: 0 !important;
        border-radius: 12px !important;
        z-index: 1001 !important;
      }

      /* Ensure header stays on top when modal is open */
      .header {
        z-index: 1002 !important;
        position: relative !important;
      }
    }

    /* Desktop modal positioning */
    @media (min-width: 769px) {
      .netlify-identity-widget .netlify-identity-modal {
        margin-top: 100px !important; /* Space for header */
      }
    }

    /* Login overlay for form blocking */
    .login-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 999;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .login-message {
      background: var(--color-white);
      padding: var(--spacing-2xl);
      border-radius: var(--radius-lg);
      text-align: center;
      max-width: 400px;
      margin: var(--spacing-xl);
      box-shadow: var(--shadow-xl);
    }

    .login-message h3 {
      margin: 0 0 var(--spacing-lg) 0;
      color: var(--color-navy);
      font-family: var(--font-secondary);
      font-weight: 700;
    }

    .login-message p {
      margin: 0 0 var(--spacing-xl) 0;
      color: var(--color-gray);
    }

    /* ===== CUSTOM NOTIFICATION SYSTEM ===== */
    .notification-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(30, 41, 59, 0.8);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: var(--z-modal);
      display: none;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: all var(--transition-base);
    }

    .notification-overlay.active {
      display: flex;
      opacity: 1;
    }

    .notification-modal {
      background: var(--color-white);
      border-radius: var(--radius-xl);
      padding: var(--spacing-2xl);
      box-shadow: var(--shadow-xl);
      max-width: 90vw;
      width: 100%;
      max-width: 400px;
      transform: scale(0.9) translateY(20px);
      transition: all var(--transition-base);
      text-align: center;
    }

    .notification-overlay.active .notification-modal {
      transform: scale(1) translateY(0);
    }

    .notification-icon {
      font-size: var(--font-size-4xl);
      margin-bottom: var(--spacing-lg);
      display: block;
    }

    .notification-icon.success {
      color: var(--color-teal);
    }

    .notification-icon.error {
      color: var(--color-coral);
    }

    .notification-icon.warning {
      color: #f59e0b;
    }

    .notification-icon.info {
      color: #3b82f6;
    }

    .notification-title {
      font-family: var(--font-secondary);
      font-size: var(--font-size-xl);
      font-weight: 700;
      color: var(--color-navy);
      margin-bottom: var(--spacing-md);
    }

    .notification-message {
      color: var(--color-gray-dark);
      font-size: var(--font-size-base);
      line-height: 1.6;
      margin-bottom: var(--spacing-xl);
    }

    .notification-buttons {
      display: flex;
      gap: var(--spacing-md);
      justify-content: center;
    }

    .notification-btn {
      padding: var(--spacing-sm) var(--spacing-lg);
      border: none;
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-base);
      min-width: 100px;
      font-family: var(--font-primary);
    }

    .notification-btn.primary {
      background: var(--gradient-primary);
      color: var(--color-white);
      box-shadow: var(--shadow-colored);
    }

    .notification-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .notification-btn.secondary {
      background: var(--color-white);
      color: var(--color-navy);
      border: 2px solid var(--color-light-gray);
    }

    .notification-btn.secondary:hover {
      border-color: var(--color-teal);
      color: var(--color-teal);
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      .notification-modal {
        margin: var(--spacing-lg);
        padding: var(--spacing-xl);
      }

      .notification-buttons {
        flex-direction: column;
      }

      .notification-btn {
        width: 100%;
      }
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: var(--spacing-xl);
    }

    .header-page {
      text-align: center;
      margin-bottom: var(--spacing-2xl);
    }

    .header-page h1 {
      font-family: var(--font-secondary);
      font-size: var(--font-size-4xl);
      margin: 0 0 var(--spacing-md) 0;
      color: var(--color-navy);
      font-weight: 800;
      letter-spacing: -0.02em;
    }

    .header-page p {
      color: var(--color-gray);
      font-size: var(--font-size-lg);
      margin: 0;
      font-weight: 400;
    }

    .form-section {
      background: var(--color-white);
      padding: var(--spacing-2xl);
      border-radius: var(--radius-lg);
      margin-bottom: var(--spacing-xl);
      box-shadow: var(--shadow-md);
      border: 2px solid var(--color-light-gray);
      transition: all var(--transition-base);
    }

    .form-section:hover {
      border-color: var(--color-teal);
      box-shadow: var(--shadow-lg);
    }

    .form-section h2 {
      margin: 0 0 var(--spacing-lg) 0;
      font-family: var(--font-secondary);
      font-size: var(--font-size-2xl);
      color: var(--color-navy);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .form-group {
      margin-bottom: var(--spacing-xl);
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    label {
      display: block;
      margin-bottom: var(--spacing-xs);
      font-weight: 600;
      color: var(--color-navy);
      font-size: var(--font-size-sm);
    }

    input[type="text"],
    input[type="url"],
    textarea,
    select {
      width: 100%;
      padding: var(--spacing-md) var(--spacing-lg);
      font-size: var(--font-size-base);
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-md);
      box-sizing: border-box;
      font-family: var(--font-primary);
      transition: all var(--transition-base);
      background: var(--color-white);
      color: var(--color-navy);
    }

    input[type="text"]::placeholder,
    input[type="url"]::placeholder,
    textarea::placeholder {
      font-size: var(--font-size-sm);
      color: var(--color-gray-light);
    }

    input[type="text"]:focus,
    input[type="url"]:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--color-teal);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    textarea {
      resize: vertical;
      min-height: 120px;
      line-height: 1.6;
    }

    .character-prompt {
      min-height: 180px;
    }

    .avatar-preview {
      margin-top: var(--spacing-md);
      display: none;
    }

    .avatar-preview img {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-full);
      object-fit: cover;
      border: 3px solid var(--color-light-gray);
      transition: all var(--transition-base);
    }

    .avatar-preview img:hover {
      border-color: var(--color-teal);
      transform: scale(1.05);
    }

    .visibility-options {
      display: flex;
      gap: var(--spacing-lg);
      margin-top: var(--spacing-md);
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      cursor: pointer;
      padding: var(--spacing-md) var(--spacing-lg);
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-md);
      transition: all var(--transition-base);
      background: var(--color-white);
      box-shadow: var(--shadow-sm);
      flex: 1;
    }

    .radio-option:hover {
      border-color: var(--color-teal);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .radio-option.selected {
      border-color: var(--color-teal);
      background: var(--color-off-white);
      box-shadow: var(--shadow-colored);
    }

    .radio-option input[type="radio"] {
      margin: 0;
      width: auto;
    }

    .radio-option-content {
      flex: 1;
    }

    .radio-option-title {
      font-weight: 600;
      margin-bottom: var(--spacing-xs);
      color: var(--color-navy);
      font-size: var(--font-size-sm);
    }

    .radio-option-desc {
      font-size: var(--font-size-xs);
      color: var(--color-gray);
      line-height: 1.4;
    }

    .button-group {
      display: flex;
      gap: var(--spacing-md);
      margin-top: var(--spacing-2xl);
    }

    button {
      padding: var(--spacing-lg) var(--spacing-2xl);
      border: none;
      border-radius: var(--radius-full);
      font-size: var(--font-size-base);
      cursor: pointer;
      font-weight: 600;
      transition: all var(--transition-base);
      font-family: var(--font-primary);
    }

    .btn-primary-form {
      background: var(--gradient-primary);
      color: var(--color-white);
      flex: 1;
      box-shadow: var(--shadow-colored);
    }

    .btn-primary-form:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
    }

    .btn-secondary-form {
      background: var(--color-white);
      color: var(--color-navy);
      border: 2px solid var(--color-teal);
      min-width: 120px;
      box-shadow: var(--shadow-sm);
    }

    .btn-secondary-form:hover {
      background: var(--color-teal);
      color: var(--color-white);
      transform: translateY(-2px);
    }

    .preview-section {
      background: var(--color-white);
      padding: var(--spacing-2xl);
      border-radius: var(--radius-lg);
      margin-bottom: var(--spacing-xl);
      box-shadow: var(--shadow-md);
      border: 2px solid var(--color-teal);
      transition: all var(--transition-base);
    }

    .preview-section h2 {
      margin: 0 0 var(--spacing-lg) 0;
      font-family: var(--font-secondary);
      font-size: var(--font-size-2xl);
      color: var(--color-navy);
      font-weight: 700;
      letter-spacing: -0.01em;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .preview-section h2::before {
      content: '👁️';
      font-size: var(--font-size-lg);
    }

    .preview-character {
      display: flex;
      align-items: center;
      gap: var(--spacing-lg);
      padding: var(--spacing-lg);
      background: var(--color-off-white);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-light-gray);
      transition: all var(--transition-base);
    }

    .preview-character:hover {
      border-color: var(--color-teal);
      box-shadow: var(--shadow-sm);
    }

    .preview-avatar {
      width: 64px;
      height: 64px;
      border-radius: var(--radius-full);
      background: var(--gradient-subtle);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-2xl);
      color: var(--color-white);
      flex-shrink: 0;
      border: 3px solid var(--color-white);
      box-shadow: var(--shadow-md);
    }

    .preview-avatar img {
      width: 100%;
      height: 100%;
      border-radius: var(--radius-full);
      object-fit: cover;
    }

    .preview-info {
      flex: 1;
      min-width: 0;
    }

    .preview-info h3 {
      margin: 0 0 var(--spacing-xs) 0;
      color: var(--color-navy);
      font-family: var(--font-secondary);
      font-size: var(--font-size-xl);
      font-weight: 700;
      line-height: 1.2;
    }

    .preview-info p {
      margin: 0;
      color: var(--color-gray);
      font-size: var(--font-size-sm);
      line-height: 1.4;
    }

    .preview-tags {
      margin-top: var(--spacing-md);
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
    }

    .preview-tag {
      background: var(--gradient-tags);
      color: var(--color-white);
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--radius-full);
      font-size: var(--font-size-xs);
      font-weight: 500;
    }

    .char-counter {
      font-size: 12px;
      color: #999;
      text-align: right;
      margin-top: 4px;
    }

    .tags-help {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    .tags-preview {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag {
      background-color: #e8f4f8;
      color: #2c5282;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .tag.invalid {
      background-color: #fed7d7;
      color: #c53030;
    }

    .tag.new-tag {
      background-color: #e6fffa;
      color: #234e52;
      border: 1px solid #4fd1c7;
    }

    .suggested-tags-section {
      margin-bottom: 16px;
    }

    .suggested-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }

    .suggested-tag {
      background-color: #e8f4f8;
      border: 2px solid #2c5282;
      color: #2c5282;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
    }

    .suggested-tag:hover {
      background-color: #c2e7f0;
    }

    .suggested-tag.selected {
      background-color: #2c5282;
      color: white;
    }

    .more-tags-button {
      padding: 8px 16px;
      background-color: #f0f0f0;
      color: #333;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .more-tags-button:hover {
      background-color: #e0e0e0;
    }

    .tags-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      padding: 20px;
      box-sizing: border-box;
    }

    .tags-modal-content {
      background: white;
      border-radius: 12px;
      max-width: 600px;
      max-height: 80vh;
      margin: 50px auto;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .tags-modal-header {
      padding: 20px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .tags-modal-header h3 {
      margin: 0;
      font-size: 20px;
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background-color 0.2s ease;
    }

    .close-modal:hover {
      background-color: #f0f0f0;
    }

    .tags-modal-body {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }

    .common-tags-section {
      margin-bottom: 24px;
    }

    .tags-modal-body h4 {
      margin: 0 0 12px 0;
      font-size: 16px;
      color: #333;
    }

    .common-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .tag-option {
      background-color: #f8f9fa;
      border: 2px solid #e9ecef;
      color: #495057;
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
    }

    .tag-option:hover {
      border-color: #666;
    }

    .tag-option.selected {
      background-color: #e8f4f8;
      border-color: #2c5282;
      color: #2c5282;
    }

    .loading-tags {
      color: #666;
      font-style: italic;
      padding: 12px;
      text-align: center;
    }

    .tags-modal-footer {
      padding: 20px;
      border-top: 1px solid #e0e0e0;
      background-color: #f8f9fa;
    }

    .selected-tags-preview {
      margin-bottom: 16px;
      font-size: 14px;
    }

    .modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    .modal-buttons button {
      padding: 10px 20px;
      font-size: 14px;
    }

    .avatar-input-options {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .avatar-option {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      transition: border-color 0.2s ease;
    }

    .avatar-option.active {
      border-color: #000;
      background-color: #f8f9fa;
    }

    .avatar-option input[type="radio"] {
      display: none;
    }

    .avatar-option > label {
      font-weight: 500;
      margin: 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .avatar-option > label::before {
      content: '';
      width: 16px;
      height: 16px;
      border: 2px solid #ccc;
      border-radius: 50%;
      background: white;
      transition: all 0.2s ease;
    }

    .avatar-option input[type="radio"]:checked + label::before {
      border-color: #000;
      background: #000;
      box-shadow: inset 0 0 0 3px white;
    }

    .upload-button {
      padding: 8px 16px;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s ease;
      align-self: flex-start;
    }

    .upload-button:hover {
      background-color: #e0e0e0;
    }

    .file-name {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    /* ===== NEW PERSONALITY BUILDER STYLES ===== */
    
    .personality-builder {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xl);
    }

    .personality-section {
      padding: var(--spacing-xl);
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-lg);
      background: var(--color-off-white);
      margin-bottom: var(--spacing-lg);
    }

    .personality-section h3 {
  margin: 0 0 var(--spacing-lg) 0;
  font-family: var(--font-secondary);
  font-size: var(--font-size-lg);
  color: var(--color-navy);
  font-weight: 600;
  line-height: 1.4;
}

    /* Sliders */
    .slider-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }

    .slider-item {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .slider-labels {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-xs);
    }

    .slider-label {
      font-size: var(--font-size-sm);
      color: var(--color-gray-dark);
      font-weight: 500;
    }

    .slider-container {
      position: relative;
      width: 100%;
    }

    .personality-slider {
      width: 100%;
      height: 8px;
      border-radius: var(--radius-full);
      background: var(--color-light-gray);
      outline: none;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
    }

    .personality-slider::-webkit-slider-thumb {
      appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--gradient-primary);
      cursor: pointer;
      border: 3px solid var(--color-white);
      box-shadow: var(--shadow-md);
      transition: all var(--transition-base);
    }

    .personality-slider::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-lg);
    }

    .personality-slider::-moz-range-thumb {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--gradient-primary);
      cursor: pointer;
      border: 3px solid var(--color-white);
      box-shadow: var(--shadow-md);
      transition: all var(--transition-base);
    }

    /* Button Groups */
    .button-group-personality {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
    }

    .personality-button {
      padding: var(--spacing-sm) var(--spacing-md);
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-full);
      background: var(--color-white);
      color: var(--color-navy);
      font-size: var(--font-size-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-base);
      user-select: none;
      font-family: var(--font-primary);
    }

    .personality-button:hover {
      border-color: var(--color-teal);
      background: var(--color-off-white);
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }

    .personality-button.selected {
      border-color: var(--color-teal);
      background: var(--color-teal);
      color: var(--color-white);
      box-shadow: var(--shadow-colored);
    }

    .personality-button.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Selection counters */
    .selection-counter {
      font-size: var(--font-size-xs);
      color: var(--color-gray);
      margin-top: var(--spacing-xs);
      text-align: right;
      font-style: italic;
    }

    .selection-counter.at-limit {
      color: var(--color-coral);
      font-weight: 600;
    }

    /* Custom quirks input */
    .custom-quirks {
      margin-top: var(--spacing-md);
    }

    .quirk-input-container {
      display: flex;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-sm);
    }

    .quirk-input {
      flex: 1;
      padding: var(--spacing-sm) var(--spacing-md);
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      font-family: var(--font-primary);
    }

    .quirk-input:focus {
      border-color: var(--color-teal);
      box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
    }

    .add-quirk-btn {
      padding: var(--spacing-sm) var(--spacing-md);
      background: var(--gradient-primary);
      color: var(--color-white);
      border: none;
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-base);
      white-space: nowrap;
    }

    .add-quirk-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .add-quirk-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Generated prompt section */
    .generated-prompt-section {
      margin-top: var(--spacing-2xl);
      margin-bottom: var(--spacing-2xl);
      padding: var(--spacing-xl);
      background: var(--color-white);
      border: 2px solid var(--color-teal);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
    }

    .generated-prompt-section h3 {
      margin: 0 0 var(--spacing-lg) 0;
      font-family: var(--font-secondary);
      font-size: var(--font-size-xl);
      color: var(--color-navy);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .generated-prompt-section h3::before {
      content: '';
      font-size: var(--font-size-lg);
    }

    .prompt-preview {
  background: var(--color-off-white);
  padding: var(--spacing-lg);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-light-gray);
  font-size: var(--font-size-sm);
  line-height: 1.6;
  color: var(--color-gray-dark);
  margin-bottom: var(--spacing-lg);
  min-height: 60px;
  max-height: 120px;
  overflow-y: auto;
}

    .prompt-empty {
      color: var(--color-gray-light);
      font-style: italic;
      text-align: center;
      padding: var(--spacing-xl);
    }

    .prompt-actions {
      display: flex;
      gap: var(--spacing-md);
      align-items: center;
    }

    .manual-edit-btn {
      padding: var(--spacing-sm) var(--spacing-lg);
      background: var(--color-white);
      color: var(--color-teal);
      border: 2px solid var(--color-teal);
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .manual-edit-btn:hover {
      background: var(--color-teal);
      color: var(--color-white);
      transform: translateY(-2px);
    }

    .manual-edit-btn:active {
      background: var(--color-teal);
      color: var(--color-white);
      transform: translateY(0);
      box-shadow: var(--shadow-md);
    }

    .regenerate-btn {
      padding: var(--spacing-sm) var(--spacing-lg);
      background: var(--color-white);
      color: var(--color-teal);
      border: 2px solid var(--color-teal);
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .regenerate-btn:hover {
      background: var(--color-teal);
      color: var(--color-white);
      transform: translateY(-2px);
    }

    .regenerate-btn:active {
      background: var(--color-teal);
      color: var(--color-white);
      transform: translateY(0);
      box-shadow: var(--shadow-md);
    }

    /* Mobile responsive adjustments */
    @media (max-width: 600px) {
      .container {
        padding: var(--spacing-lg);
      }

      .header-page h1 {
        font-size: var(--font-size-3xl);
      }

      .form-section {
        padding: var(--spacing-xl);
      }

      .visibility-options {
        flex-direction: column;
        gap: var(--spacing-md);
      }

      .button-group {
        flex-direction: column;
      }

      .slider-labels {
        font-size: var(--font-size-xs);
      }

      .button-group-personality {
        gap: var(--spacing-xs);
      }

      .personality-button {
        font-size: var(--font-size-xs);
        padding: var(--spacing-xs) var(--spacing-sm);
      }

      .quirk-input-container {
        flex-direction: column;
      }

      .prompt-actions {
        flex-direction: column;
      }
    }

    /* Accessibility improvements */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Focus styles for keyboard navigation */
    .btn:focus,
    button:focus,
    input:focus,
    textarea:focus,
    select:focus,
    .radio-option:focus,
    .personality-button:focus,
    .personality-slider:focus {
      outline: 2px solid var(--color-teal);
      outline-offset: 2px;
    }

    /* ===== FOOTER STYLES ===== */
    .footer {
      background: var(--color-white);
      border-top: 1px solid var(--color-light-gray);
      padding: var(--spacing-xl) 0;
      margin-top: var(--spacing-3xl);
    }

    .footer-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 var(--spacing-lg);
      text-align: center;
    }

    .footer-links {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
      flex-wrap: wrap;
    }

    .footer-link {
      color: var(--color-gray);
      text-decoration: none;
      font-size: var(--font-size-sm);
      font-weight: 500;
      transition: color var(--transition-base);
    }

    .footer-link:hover {
      color: var(--color-teal);
    }

    .footer-separator {
      color: var(--color-gray-light);
      font-size: var(--font-size-sm);
    }

    .footer-copyright {
      color: var(--color-gray-light);
      font-size: var(--font-size-xs);
      margin: 0;
    }

    /* Mobile footer adjustments */
    @media (max-width: 768px) {
      .footer {
        padding: var(--spacing-lg) 0;
        margin-top: var(--spacing-2xl);
      }

      .footer-container {
        padding: 0 var(--spacing-md);
      }

      .footer-links {
        gap: var(--spacing-md);
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header" role="banner">
  <div class="header-container">
    <div class="header-content">
      <!-- Logo -->
      <a href="index.html" class="logo" aria-label="Narrin AI Home">Narrin AI</a>

      <!-- Desktop Navigation Center -->
      <nav class="nav-center" role="navigation" aria-label="Main navigation">
        <!-- USPs - All visible on desktop -->
        <div class="nav-usps" aria-label="Key features">
          <div class="usp-item">
            <span class="usp-icon" aria-hidden="true">🔒</span>
            <span>100% Safe</span>
          </div>
          <div class="usp-item">
            <span class="usp-icon" aria-hidden="true">🧠</span>
            <span>Character Memory</span>
          </div>
          <div class="usp-item">
            <span class="usp-icon" aria-hidden="true">🔐</span>
            <span>Private Data</span>
          </div>
        </div>

        <!-- Search Icon - Desktop -->
        <button
          class="mobile-search-btn"
          id="desktopSearchBtn"
          aria-label="Open search"
          aria-expanded="false"
          style="display: flex;"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
      </nav>

      <!-- Desktop Navigation Links -->
      <nav class="nav-links" role="navigation" aria-label="Secondary navigation">
        <a href="index.html" class="nav-link">Characters</a>
        <a href="chat-overview.html" class="nav-link">Chats</a>
        <a href="profile.html" class="nav-link" id="loginBtn">Login/Register</a>
        <a href="create-character.html" class="btn btn-primary">✨ Create Character</a>
      </nav>

      <!-- Mobile Navigation Container -->
      <div class="mobile-nav-container">
        <!-- Mobile USP Carousel -->
        <div class="mobile-usp-carousel" aria-label="Key features carousel">
          <div class="mobile-usp-track" id="uspTrack">
            <div class="mobile-usp-item">
              <span class="usp-icon" aria-hidden="true">🔒</span>
              <span>100% Safe</span>
            </div>
            <div class="mobile-usp-item">
              <span class="usp-icon" aria-hidden="true">🧠</span>
              <span>Character Memory</span>
            </div>
            <div class="mobile-usp-item">
              <span class="usp-icon" aria-hidden="true">🔐</span>
              <span>Private Data</span>
            </div>
          </div>
        </div>

        <!-- Mobile Search Button -->
        <button 
          class="mobile-search-btn" 
          id="mobileSearchBtn"
          aria-label="Open search"
          aria-expanded="false"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>

        <!-- Mobile Hamburger Menu -->
        <button
          class="mobile-menu-btn"
          id="mobileMenuBtn"
          aria-label="Open navigation menu"
          aria-expanded="false"
        >
          <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </button>
      </div>
    </div>

    <!-- Mobile Search Overlay -->
    <div class="mobile-search-overlay" id="mobileSearchOverlay">
      <form class="mobile-search-form" role="search">
        <input 
          type="search" 
          class="mobile-search-input" 
          placeholder="Search characters..." 
          aria-label="Search characters"
          id="mobileSearchInput"
        />
        <button type="submit" class="btn btn-primary" aria-label="Submit search">
          Search
        </button>
      </form>
    </div>
  </div>
</header>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" id="mobileMenuOverlay">
    <div class="mobile-menu-content">
      <div class="mobile-menu-header">
        <div class="mobile-menu-logo">Narrin AI</div>
        <div class="mobile-menu-subtitle">AI Character Chat</div>
      </div>
      <nav class="mobile-menu-nav" role="navigation" aria-label="Mobile navigation">
        <a href="index.html" class="mobile-menu-link">
          <span class="mobile-menu-link-icon">🏠</span>
          Characters
        </a>
        <a href="chat-overview.html" class="mobile-menu-link">
          <span class="mobile-menu-link-icon">💬</span>
          Chats
        </a>
        <a href="profile.html" class="mobile-menu-link" id="mobileLoginBtn">
          <span class="mobile-menu-link-icon">👤</span>
          Login/Register
        </a>
        <a href="create-character.html" class="mobile-menu-link btn-primary">
          <span class="mobile-menu-link-icon">✨</span>
          Create Character
        </a>
      </nav>
    </div>
  </div>

  <!-- Custom Notification System -->
  <div class="notification-overlay" id="notificationOverlay">
    <div class="notification-modal">
      <span class="notification-icon" id="notificationIcon">✓</span>
      <h3 class="notification-title" id="notificationTitle">Success</h3>
      <p class="notification-message" id="notificationMessage">Operation completed successfully!</p>
      <div class="notification-buttons" id="notificationButtons">
        <button class="notification-btn primary" id="notificationOkBtn">OK</button>
      </div>
    </div>
  </div>

  <!-- Login Overlay -->
  <div class="login-overlay" id="loginOverlay">
    <div class="login-message">
      <h3>Login Required</h3>
      <p>Please log in to create a character</p>
      <button class="btn btn-primary" onclick="showLoginModal()">Login</button>
      <button class="btn btn-secondary" onclick="hideLoginOverlay()" style="margin-left: 10px;">Cancel</button>
    </div>
  </div>

  <div class="container">
    <div class="header-page">
      <h1>Create New Character</h1>
      <p>Bring your character to life with a custom personality and communication style</p>
    </div>

    <form id="characterForm">
      <!-- Character Personality -->
      <div class="form-section">
        <h2>Character Personality 🎭</h2>
        
        <div class="form-group">
          <label for="characterName">Character Name *</label>
          <input type="text" id="characterName" name="characterName" required 
                 placeholder="e.g. Einstein, Gandalf, Marie Curie, Life Coach Sarah" 
                 maxlength="50">
          <div class="char-counter"><span id="nameCounter">0</span>/50</div>
        </div>

        <div class="form-group">
          <label for="characterTitle">Short Tagline *</label>
          <input type="text" id="characterTitle" name="characterTitle" required
                 placeholder="e.g. Brilliant Physicist, Wise Wizard, Career Coach, Ancient Philosopher" 
                 maxlength="100">
          <div class="char-counter"><span id="titleCounter">0</span>/100</div>
        </div>

        <!-- Personality Builder -->
        <div class="personality-builder">
          <!-- Personality Sliders -->
          <div class="personality-section">
<h3>Personality Spectrum 🎚️<br><span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></h3>            <div class="slider-group">
              <div class="slider-item">
                <div class="slider-labels">
                  <span class="slider-label">Introvert</span>
                  <span class="slider-label">Extravert</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="personality-slider" id="introvertExtraverts" data-trait="social">
              </div>
              
              <div class="slider-item">
                <div class="slider-labels">
                  <span class="slider-label">Logical</span>
                  <span class="slider-label">Emotional</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="personality-slider" id="logicalEmotional" data-trait="thinking">
              </div>
              
              <div class="slider-item">
                <div class="slider-labels">
                  <span class="slider-label">Serious</span>
                  <span class="slider-label">Playful</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="personality-slider" id="seriousPlayful" data-trait="mood">
              </div>
              
              <div class="slider-item">
                <div class="slider-labels">
                  <span class="slider-label">Formal</span>
                  <span class="slider-label">Casual</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="personality-slider" id="formalCasual" data-trait="formality">
              </div>
              
              <div class="slider-item">
                <div class="slider-labels">
                  <span class="slider-label">Patient</span>
                  <span class="slider-label">Impulsive</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="personality-slider" id="patientImpulsive" data-trait="tempo">
              </div>
            </div>
          </div>

          <!-- Personality Traits -->
          <div class="personality-section">
<h3>Character Traits ✨<br><span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></h3>            <div class="button-group-personality" id="personalityTraits">
              <button type="button" class="personality-button" data-trait="wise">Wise</button>
              <button type="button" class="personality-button" data-trait="humorous">Humorous</button>
              <button type="button" class="personality-button" data-trait="mysterious">Mysterious</button>
              <button type="button" class="personality-button" data-trait="caring">Caring</button>
              <button type="button" class="personality-button" data-trait="ambitious">Ambitious</button>
              <button type="button" class="personality-button" data-trait="sarcastic">Sarcastic</button>
              <button type="button" class="personality-button" data-trait="optimistic">Optimistic</button>
              <button type="button" class="personality-button" data-trait="protective">Protective</button>
              <button type="button" class="personality-button" data-trait="curious">Curious</button>
              <button type="button" class="personality-button" data-trait="dramatic">Dramatic</button>
              <button type="button" class="personality-button" data-trait="confident">Confident</button>
              <button type="button" class="personality-button" data-trait="gentle">Gentle</button>
              <button type="button" class="personality-button" data-trait="intense">Intense</button>
              <button type="button" class="personality-button" data-trait="creative">Creative</button>
              <button type="button" class="personality-button" data-trait="analytical">Analytical</button>
            </div>
            <div class="selection-counter" id="traitsCounter">Select 0-5 traits that describe your character</div>
          </div>
        </div>
      </div>

      <!-- Communication Style -->
      <div class="form-section">
        <h2>💬 Communication Style</h2>
        
        <!-- Speaking Pattern -->
        <div class="personality-section">
<h3>Speaking Pattern 🗣️<br><span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></h3>          <div class="button-group-personality" id="speakingPattern">
            <button type="button" class="personality-button" data-pattern="formal-eloquent">📜 Formal & Eloquent</button>
            <button type="button" class="personality-button" data-pattern="casual-friendly">🗣️ Casual & Friendly</button>
            <button type="button" class="personality-button" data-pattern="bold-confident">💪 Bold & Confident</button>
            <button type="button" class="personality-button" data-pattern="thoughtful-deep">🤔 Thoughtful & Deep</button>
            <button type="button" class="personality-button" data-pattern="witty-sarcastic">😄 Witty & Sarcastic</button>
            <button type="button" class="personality-button" data-pattern="warm-nurturing">💝 Warm & Nurturing</button>
            <button type="button" class="personality-button" data-pattern="direct-practical">🎯 Direct & Practical</button>
            <button type="button" class="personality-button" data-pattern="mysterious-cryptic">✨ Mysterious & Cryptic</button>
          </div>
          <div class="selection-counter" id="speakingCounter">Select 0-3 speaking patterns that fit your character</div>
        </div>

        <!-- Response Style Sliders -->
        <div class="personality-section">
<h3>Response Style 📝<br><span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></h3>          <div class="slider-group">
            <div class="slider-item">
              <div class="slider-labels">
                <span class="slider-label">Brief</span>
                <span class="slider-label">Detailed</span>
              </div>
              <input type="range" min="0" max="100" value="50" class="personality-slider" id="briefDetailed" data-response="length">
            </div>
            
            <div class="slider-item">
              <div class="slider-labels">
                <span class="slider-label">Direct</span>
                <span class="slider-label">Storytelling</span>
              </div>
              <input type="range" min="0" max="100" value="50" class="personality-slider" id="directStorytelling" data-response="style">
            </div>
            
            <div class="slider-item">
              <div class="slider-labels">
                <span class="slider-label">Facts</span>
                <span class="slider-label">Personal experiences</span>
              </div>
              <input type="range" min="0" max="100" value="50" class="personality-slider" id="factsPersonal" data-response="content">
            </div>
          </div>
        </div>

        <!-- Bonding Approach -->
        <div class="personality-section">
<h3>Bonding Approach 🤝<br><span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></h3>          <div class="button-group-personality" id="bondingApproach">
            <button type="button" class="personality-button" data-bonding="mentor-teacher">🏆 Mentor & Teacher</button>
            <button type="button" class="personality-button" data-bonding="friend-companion">👥 Friend & Companion</button>
            <button type="button" class="personality-button" data-bonding="protector-guide">🛡️ Protector & Guide</button>
            <button type="button" class="personality-button" data-bonding="challenger-motivator">🎯 Challenger & Motivator</button>
            <button type="button" class="personality-button" data-bonding="advisor-counselor">💡 Advisor & Counselor</button>
            <button type="button" class="personality-button" data-bonding="entertainer-inspiring">🎪 Entertainer & Inspiring</button>
          </div>
          <div class="selection-counter" id="bondingCounter">Select 0-2 approaches that define how your character connects</div>
        </div>

        <!-- Personality Quirks -->
        <div class="personality-section">
<h3>Personality Quirks 🎭<br><span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></h3>          <div class="button-group-personality" id="personalityQuirks">
            <button type="button" class="personality-button" data-quirk="historical-references">Makes historical references</button>
            <button type="button" class="personality-button" data-quirk="food-metaphors">Uses food metaphors</button>
            <button type="button" class="personality-button" data-quirk="collects-facts">Collects interesting facts</button>
            <button type="button" class="personality-button" data-quirk="tells-stories">Tells relevant stories</button>
            <button type="button" class="personality-button" data-quirk="strong-opinions">Has strong opinions</button>
            <button type="button" class="personality-button" data-quirk="gets-excited">Gets excited about expertise</button>
            <button type="button" class="personality-button" data-quirk="remembers-details">Remembers small details</button>
            <button type="button" class="personality-button" data-quirk="unusual-phrases">Uses unusual phrases</button>
          </div>
          
          <!-- Custom Quirks Input -->
          <div class="custom-quirks">
            <label for="customQuirk">Add custom quirk:</label>
            <div class="quirk-input-container">
              <input type="text" id="customQuirk" class="quirk-input" placeholder="e.g. Always quotes Shakespeare, Loves space analogies, Speaks like a pirate..." maxlength="50">
              <button type="button" id="addCustomQuirk" class="add-quirk-btn">Add</button>
            </div>
          </div>
        </div>

        <div class="form-group" style="margin-top: var(--spacing-2xl);">
          <label for="characterDescription">How would this character describe themselves? <span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></label>
          <textarea id="characterDescription" name="characterDescription" 
                    placeholder="I am Dr. Maya Chen, a mindfulness coach who helps people find inner peace. I believe everyone has the capacity for growth and self-discovery. My approach combines ancient wisdom with modern psychology to guide you on your journey." 
                    maxlength="1000"></textarea>
          <div class="char-counter"><span id="descCounter">0</span>/1000</div>
        </div>
      </div>

      <!-- Generated Prompt -->
      <div class="form-section">
        <div class="generated-prompt-section">
          <h3>Generated Character Prompt *</h3>
          <div class="prompt-preview" id="promptPreview">
            <div class="prompt-empty">Select personality traits above to generate your character prompt...</div>
          </div>
          <div class="prompt-actions">
            <button type="button" id="manualEdit" class="manual-edit-btn">✏️ Edit Manually</button>
          </div>
          <div style="font-size: var(--font-size-xs); color: var(--color-gray); margin-top: var(--spacing-sm); font-style: italic;">
            Click "Edit Manually" to customize the generated prompt or make changes to personality selections above to auto-update.
          </div>
        </div>
        
        <div class="form-group" id="manualPromptGroup" style="display: none; margin-top: var(--spacing-xl);">
          <label for="characterPrompt">Character Prompt *</label>
          <textarea id="characterPrompt" name="characterPrompt" required 
                    class="character-prompt"
                    placeholder="Your generated prompt will appear here..."></textarea>
          <div class="char-counter"><span id="promptCounter">0</span>/2000</div>
          <div class="prompt-actions" style="margin-top: var(--spacing-md);">
            <button type="button" id="backToGenerated" class="regenerate-btn">← Back to Generated</button>
          </div>
        </div>
      </div>

      <!-- Character profile image -->
      <div class="form-section">
        <h2>👤 Character profile image <span style="font-size: var(--font-size-sm); color: var(--color-gray); font-weight: normal;">(Optional)</span></h2>
        
        <div class="form-group">
          <label>Image</label>
          <div class="avatar-input-options">
            <div class="avatar-option">
              <input type="radio" id="avatarUpload" name="avatarMethod" value="upload" checked>
              <label for="avatarUpload">Upload Image</label>
              <input type="file" id="avatarFileInput" name="avatarFileInput" 
                     accept="image/*" style="display: none;">
              <button type="button" class="upload-button" onclick="triggerFileUpload()">
                Choose File
              </button>
              <span class="file-name" id="fileName">No file chosen</span>
            </div>
            
            <div class="avatar-option">
              <input type="radio" id="avatarUrl" name="avatarMethod" value="url">
              <label for="avatarUrl">Image URL</label>
                           <input type="url" id="avatarUrlInput" name="avatarUrlInput" 
                    placeholder="https://example.com/character-image.jpg">
           </div>
         </div>
         
         <div class="avatar-preview" id="avatarPreview">
           <img id="avatarImg" src="" alt="Avatar preview">
         </div>
       </div>
     </div>

     <!-- Tags & Categorization -->
     <div class="form-section">
       <h2>🏷️ Tags & Category</h2>
       
       <div class="form-group">
         <label for="characterCategory">Primary Category *</label>
         <select id="characterCategory" name="characterCategory" required>
  <option value="">Select a category...</option>
  <option value="historical">🏛️ Historical Figures</option>
  <option value="fantasy">🧙‍♂️ Fantasy</option>
  <option value="anime-manga">🎌 Anime & Manga</option>
  <option value="celebrity">⭐ Celebrities</option>
  <option value="gaming">🎮 Gaming</option>
  <option value="movies-tv">🎬 Movies & TV</option>
  <option value="mythology">⚡ Mythology</option>
  <option value="original">✨ Original Characters</option>
  <option value="ai-assistant">🤖 AI Assistants</option>
  <option value="educational">📖 Educational</option>
  <option value="fitness-coach">💪 Fitness Coach</option>
  <option value="business-coach">💼 Business Coach</option>
  <option value="language-coach">🗣️ Language Coach</option>
  <option value="accounting-coach">💰 Accounting Coach</option>
  <option value="career-coach">📈 Career Coach</option>
  <option value="negotiation-coach">🤝 Negotiation Coach</option>
  <option value="creativity-coach">🎨 Creativity Coach</option>
  <option value="study-coach">📚 Study Coach</option>
  <option value="relationship-coach">💝 Relationship Coach</option>
  <option value="mindfulness-coach">🧘 Mindfulness Coach</option>
  <option value="cooking-coach">👨‍🍳 Cooking Coach</option>
  <option value="other">🔹 Other</option>
  <option value="fictional">📚 Fictional</option>
</select>
       </div>
       
       <div class="form-group">
         <label>Tags <span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional - Select up to 6)</span></label>
         <div class="suggested-tags-section">
           <div class="suggested-tags" id="suggestedTags">
             <!-- Suggested tags will be generated here -->
           </div>
           <button type="button" class="more-tags-button" id="moreTagsButton">
             Browse More Tags
           </button>
         </div>
         <div class="tags-help">
           Select up to 6 tags that best describe your character. These help others discover your character.
         </div>
         <div class="tags-preview" id="tagsPreview"></div>
       </div>
     </div>

     <!-- Tags Modal -->
     <div class="tags-modal" id="tagsModal">
       <div class="tags-modal-content">
         <div class="tags-modal-header">
           <h3>Browse Tags</h3>
           <button type="button" class="close-modal" id="closeModalBtn">×</button>
         </div>
         
         <div class="tags-modal-body">
           <div class="common-tags-section">
             <h4>🏷️ Available Tags</h4>
             <div class="common-tags" id="commonTags"></div>
           </div>
         </div>
         
         <div class="tags-modal-footer">
           <div class="selected-tags-preview">
             <strong>Selected:</strong> <span id="selectedTagsPreview">None</span>
           </div>
           <div class="modal-buttons">
             <button type="button" class="btn-secondary" id="cancelTagsBtn">Cancel</button>
             <button type="button" class="btn-primary" id="applyTagsBtn">Apply Tags</button>
           </div>
         </div>
       </div>
     </div>

     <!-- Visibility -->
     <div class="form-section">
       <h2>🔒 Privacy Settings *</h2>
       
       <div class="form-group">
         <label>Who can use this character?</label>
         <div class="visibility-options">
           <div class="radio-option selected" onclick="selectVisibility('public')">
             <input type="radio" name="visibility" value="public" checked>
             <div class="radio-option-content">
               <div class="radio-option-title">🌍 Public</div>
               <div class="radio-option-desc">Share this character with the world - your chats remain private.</div>
             </div>
           </div>
           <div class="radio-option" onclick="selectVisibility('private')">
             <input type="radio" name="visibility" value="private">
             <div class="radio-option-content">
               <div class="radio-option-title">🔒 Private</div>
               <div class="radio-option-desc">Only you can chat with this character.</div>
             </div>
           </div>
         </div>
       </div>
     </div>

     <!-- Preview -->
     <div class="preview-section" id="previewSection" style="display: none;">
       <h2>Preview</h2>
       <div class="preview-character">
         <div class="preview-avatar" id="previewAvatar">
           👤
         </div>
         <div class="preview-info">
           <h3 id="previewName">Character Name</h3>
           <p id="previewTitle">Character title will appear here</p>
           <div class="preview-tags" id="previewTags"></div>
         </div>
       </div>
     </div>

     <!-- Buttons -->
     <div class="button-group">
       <button type="submit" class="btn-primary-form">Create Character</button>
     </div>
   </form>
 </div>

 <script>
   // Global variables
   let selectedTags = [];
   let currentAvatarUrl = '';
   let pendingCharacterData = null;
   
   // Personality builder state
   let personalityState = {
     sliders: {
       social: 50,
       thinking: 50,
       mood: 50,
       formality: 50,
       tempo: 50,
       length: 50,
       style: 50,
       content: 50
     },
     traits: [],
     speaking: [],
     bonding: [],
     quirks: []
   };

   // ===== NAVIGATION FUNCTIONALITY =====
   
   // Mobile Search Elements
   const mobileSearchBtn = document.getElementById('mobileSearchBtn');
   const mobileSearchOverlay = document.getElementById('mobileSearchOverlay');
   const mobileSearchInput = document.getElementById('mobileSearchInput');
   
   // Mobile Menu Elements
   const mobileMenuBtn = document.getElementById('mobileMenuBtn');
   const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
   
   // USP Carousel Elements
   const uspTrack = document.getElementById('uspTrack');
   let currentUspIndex = 0;
   let uspInterval;

   // ===== MOBILE SEARCH FUNCTIONALITY =====
   function toggleMobileSearch() {
     const isActive = mobileSearchOverlay.classList.contains('active');
     
     if (isActive) {
       mobileSearchOverlay.classList.remove('active');
       mobileSearchBtn.setAttribute('aria-expanded', 'false');
     } else {
       // Close mobile menu if open
       closeMobileMenu();
       
       mobileSearchOverlay.classList.add('active');
       mobileSearchBtn.setAttribute('aria-expanded', 'true');
       mobileSearchInput.focus();
     }
   }

   mobileSearchBtn?.addEventListener('click', toggleMobileSearch);

   // Desktop search button
   const desktopSearchBtn = document.getElementById('desktopSearchBtn');
   desktopSearchBtn?.addEventListener('click', toggleMobileSearch);

   // ===== MOBILE MENU FUNCTIONALITY =====
   function toggleMobileMenu() {
     const isActive = mobileMenuOverlay.classList.contains('active');
     
     if (isActive) {
       closeMobileMenu();
     } else {
       openMobileMenu();
     }
   }

   function openMobileMenu() {
     // Close search overlay if open
     if (mobileSearchOverlay.classList.contains('active')) {
       mobileSearchOverlay.classList.remove('active');
       mobileSearchBtn.setAttribute('aria-expanded', 'false');
     }
     
     mobileMenuOverlay.classList.add('active');
     mobileMenuBtn.classList.add('active');
     mobileMenuBtn.setAttribute('aria-expanded', 'true');
     
     // Prevent body scroll
     document.body.style.overflow = 'hidden';
   }

   function closeMobileMenu() {
     mobileMenuOverlay.classList.remove('active');
     mobileMenuBtn.classList.remove('active');
     mobileMenuBtn.setAttribute('aria-expanded', 'false');
     
     // Restore body scroll
     document.body.style.overflow = '';
   }

   mobileMenuBtn?.addEventListener('click', toggleMobileMenu);

   // Close menu when clicking on overlay background
   mobileMenuOverlay?.addEventListener('click', (e) => {
     if (e.target === mobileMenuOverlay) {
       closeMobileMenu();
     }
   });

   // Close menu when clicking on a menu item
   document.querySelectorAll('.mobile-menu-link').forEach(link => {
     link.addEventListener('click', closeMobileMenu);
   });

   // Close search and menu on outside click
   document.addEventListener('click', (e) => {
     // Close search overlay
     if (!mobileSearchOverlay?.contains(e.target) &&
         !mobileSearchBtn?.contains(e.target) &&
         mobileSearchOverlay?.classList.contains('active')) {
       mobileSearchOverlay.classList.remove('active');
       mobileSearchBtn.setAttribute('aria-expanded', 'false');
     }
   });

   // Close menu on escape key
   document.addEventListener('keydown', (e) => {
     if (e.key === 'Escape') {
       if (mobileMenuOverlay.classList.contains('active')) {
         closeMobileMenu();
       }
       if (mobileSearchOverlay.classList.contains('active')) {
         mobileSearchOverlay.classList.remove('active');
         mobileSearchBtn.setAttribute('aria-expanded', 'false');
       }
     }
   });

   // ===== USP CAROUSEL FUNCTIONALITY =====
   function startUspCarousel() {
     if (window.innerWidth <= 768 && uspTrack) {
       uspInterval = setInterval(() => {
         currentUspIndex = (currentUspIndex + 1) % 3;
         uspTrack.style.transform = `translateY(-${currentUspIndex * 33.333}%)`;
       }, 3000);
     }
   }

   function stopUspCarousel() {
     if (uspInterval) {
       clearInterval(uspInterval);
       uspInterval = null;
     }
   }

   // Handle responsive behavior
   function handleResize() {
     if (window.innerWidth > 768) {
       stopUspCarousel();
       if (uspTrack) {
         uspTrack.style.transform = '';
       }
       if (mobileSearchOverlay?.classList.contains('active')) {
         mobileSearchOverlay.classList.remove('active');
         mobileSearchBtn?.setAttribute('aria-expanded', 'false');
       }
       if (mobileMenuOverlay?.classList.contains('active')) {
         closeMobileMenu();
       }
     } else {
       startUspCarousel();
     }
   }

   // Initialize on load
   window.addEventListener('load', () => {
     handleResize();
   });

   // Handle window resize
   let resizeTimer;
   window.addEventListener('resize', () => {
     clearTimeout(resizeTimer);
     resizeTimer = setTimeout(handleResize, 250);
   });

   // ===== SEARCH FUNCTIONALITY =====
   function handleSearch(searchTerm) {
     console.log('Search term:', searchTerm);
     // Implement search functionality here
   }

   // Desktop search
   document.querySelector('.nav-search')?.addEventListener('submit', (e) => {
     e.preventDefault();
     const searchInput = e.target.querySelector('.nav-search-input');
     handleSearch(searchInput.value);
   });

   // Mobile search
   document.querySelector('.mobile-search-form')?.addEventListener('submit', (e) => {
     e.preventDefault();
     const searchInput = e.target.querySelector('.mobile-search-input');
     handleSearch(searchInput.value);
     toggleMobileSearch();
   });

   // ===== NETLIFY IDENTITY BUTTON UPDATES =====
   function updateLoginButton() {
     const loginBtn = document.getElementById('loginBtn');
     const mobileLoginBtn = document.getElementById('mobileLoginBtn');
     
     // Check both Netlify Identity and local storage for user info
     const netlifyUser = window.netlifyIdentity && window.netlifyIdentity.currentUser();
     const localEmail = localStorage.getItem("user_email");
     const localToken = localStorage.getItem("user_token");
     
     const isLoggedIn = netlifyUser || (localEmail && localToken);
     
     if (isLoggedIn) {
       // Always show "Profile" for logged in users instead of their name
       
       // Update desktop button
       if (loginBtn) {
         loginBtn.textContent = 'Profile';
         loginBtn.href = 'profile.html';
       }
       
       // Update mobile button
       if (mobileLoginBtn) {
         const icon = mobileLoginBtn.querySelector('.mobile-menu-link-icon');
         mobileLoginBtn.innerHTML = `${icon ? icon.outerHTML : '<span class="mobile-menu-link-icon">👤</span>'}Profile`;
         mobileLoginBtn.href = 'profile.html';
       }
     } else {
       // User is not logged in
       if (loginBtn) {
         loginBtn.textContent = 'Login/Register';
         loginBtn.href = 'profile.html';
       }
       if (mobileLoginBtn) {
         const icon = mobileLoginBtn.querySelector('.mobile-menu-link-icon');
         mobileLoginBtn.innerHTML = `${icon ? icon.outerHTML : '<span class="mobile-menu-link-icon">👤</span>'}Login/Register`;
         mobileLoginBtn.href = 'profile.html';
       }
     }
   }

   // Enhanced click handler for navigation links
   function setupNavigationClickHandlers() {
     const loginBtn = document.getElementById('loginBtn');
     const mobileLoginBtn = document.getElementById('mobileLoginBtn');
     
     // Desktop login button click handler
     if (loginBtn) {
       loginBtn.addEventListener('click', (e) => {
         e.preventDefault();
         
         const netlifyUser = window.netlifyIdentity && window.netlifyIdentity.currentUser();
         const localEmail = localStorage.getItem("user_email");
         const localToken = localStorage.getItem("user_token");
         const isLoggedIn = netlifyUser || (localEmail && localToken);
         
         if (isLoggedIn) {
           // User is logged in, go directly to profile page
           window.location.href = 'profile.html';
         } else {
           // User not logged in, store current page for redirect and open login
           localStorage.setItem('login_redirect_url', window.location.href);
           openLogin();
         }
       });
     }
     
     // Mobile login button click handler
     if (mobileLoginBtn) {
       mobileLoginBtn.addEventListener('click', (e) => {
         e.preventDefault();
         
         const netlifyUser = window.netlifyIdentity && window.netlifyIdentity.currentUser();
         const localEmail = localStorage.getItem("user_email");
         const localToken = localStorage.getItem("user_token");
         const isLoggedIn = netlifyUser || (localEmail && localToken);
         
         if (isLoggedIn) {
           // User is logged in, go directly to profile page
           window.location.href = 'profile.html';
         } else {
           // User not logged in, store current page for redirect and open login
           localStorage.setItem('login_redirect_url', window.location.href);
           openLogin();
         }
         
         // Close mobile menu after click
         closeMobileMenu();
       });
     }
   }

   // Function to open login modal
   function openLogin() {
     if (window.netlifyIdentity) {
       window.netlifyIdentity.open('login');
     } else {
       // Fallback if Netlify Identity is not available
       window.location.href = 'profile.html';
     }
   }

   // Initialize login button on page load
   document.addEventListener('DOMContentLoaded', () => {
     // Update immediately on page load
     updateLoginButton();
     
     // Set up click handlers
     setupNavigationClickHandlers();
     
     if (window.netlifyIdentity) {
       window.netlifyIdentity.on('init', user => {
         updateLoginButton();
       });

       window.netlifyIdentity.on('login', user => {
         updateLoginButton();
         window.netlifyIdentity.close();
       });

       window.netlifyIdentity.on('logout', () => {
         updateLoginButton();
       });
     }
   });

   // ===== CUSTOM NOTIFICATION SYSTEM =====
   function showNotification(type, title, message, buttons = null) {
     const overlay = document.getElementById('notificationOverlay');
     const icon = document.getElementById('notificationIcon');
     const titleEl = document.getElementById('notificationTitle');
     const messageEl = document.getElementById('notificationMessage');
     const buttonsEl = document.getElementById('notificationButtons');
     
     // Set icon based on type
     const icons = {
       success: '✅',
       error: '❌',
       warning: '⚠️',
       info: 'ℹ️',
       question: '❓'
     };
     
     icon.textContent = icons[type] || icons.info;
     icon.className = `notification-icon ${type}`;
     titleEl.textContent = title;
     messageEl.textContent = message;
     
     // Set up buttons
     if (buttons) {
       buttonsEl.innerHTML = '';
       buttons.forEach(button => {
         const btn = document.createElement('button');
         btn.className = `notification-btn ${button.type || 'secondary'}`;
         btn.textContent = button.text;
         btn.onclick = () => {
           hideNotification();
           if (button.callback) button.callback();
         };
         buttonsEl.appendChild(btn);
       });
     } else {
       // Default OK button
       buttonsEl.innerHTML = '<button class="notification-btn primary" onclick="hideNotification()">OK</button>';
     }
     
     // Show notification
     overlay.classList.add('active');
     document.body.style.overflow = 'hidden';
   }
   
   function hideNotification() {
     const overlay = document.getElementById('notificationOverlay');
     overlay.classList.remove('active');
     document.body.style.overflow = '';
   }
   
   // Custom alert replacement
   function customAlert(message, title = 'Notification') {
     showNotification('info', title, message);
   }
   
   // Custom confirm replacement
   function customConfirm(message, title = 'Confirm', onConfirm = null, onCancel = null) {
     const buttons = [
       {
         text: 'Cancel',
         type: 'secondary',
         callback: onCancel
       },
       {
         text: 'Confirm',
         type: 'primary',
         callback: onConfirm
       }
     ];
     showNotification('question', title, message, buttons);
   }
   
   // Success notification
   function showSuccess(message, title = 'Success') {
     showNotification('success', title, message);
   }
   
   // Error notification
   function showError(message, title = 'Error') {
     showNotification('error', title, message);
   }
   
   // Warning notification
   function showWarning(message, title = 'Warning') {
     showNotification('warning', title, message);
   }

   // ===== PERSONALITY BUILDER FUNCTIONALITY =====
   
   // Setup personality sliders
   function setupPersonalitySliders() {
     const sliders = document.querySelectorAll('.personality-slider');
     sliders.forEach(slider => {
       slider.addEventListener('input', (e) => {
         const trait = e.target.getAttribute('data-trait') || e.target.getAttribute('data-response');
         personalityState.sliders[trait] = parseInt(e.target.value);
         generatePrompt();
       });
     });
   }

   // Setup personality trait buttons - FIXED
   function setupPersonalityButtons() {
     // Personality traits (max 5)
     const traitButtons = document.querySelectorAll('#personalityTraits .personality-button');
     traitButtons.forEach(button => {
       button.addEventListener('click', (e) => {
         e.preventDefault();
         const trait = button.getAttribute('data-trait');
         toggleArraySelection(personalityState.traits, trait, 5, button, 'traitsCounter', 'traits');
       });
     });

     // Speaking patterns (max 3)
     const speakingButtons = document.querySelectorAll('#speakingPattern .personality-button');
     speakingButtons.forEach(button => {
       button.addEventListener('click', (e) => {
         e.preventDefault();
         const pattern = button.getAttribute('data-pattern');
         toggleArraySelection(personalityState.speaking, pattern, 3, button, 'speakingCounter', 'speaking patterns');
       });
     });

     // Bonding approach (max 2)
     const bondingButtons = document.querySelectorAll('#bondingApproach .personality-button');
     bondingButtons.forEach(button => {
       button.addEventListener('click', (e) => {
         e.preventDefault();
         const bonding = button.getAttribute('data-bonding');
         toggleArraySelection(personalityState.bonding, bonding, 2, button, 'bondingCounter', 'bonding approaches');
       });
     });

     // Personality quirks (no max)
     const quirkButtons = document.querySelectorAll('#personalityQuirks .personality-button');
     quirkButtons.forEach(button => {
       button.addEventListener('click', (e) => {
         e.preventDefault();
         const quirk = button.getAttribute('data-quirk');
         toggleArraySelection(personalityState.quirks, quirk, Infinity, button);
       });
     });
   }

   // Toggle selection in array with max limit - FIXED
   function toggleArraySelection(array, item, maxLimit, buttonElement, counterId = null, labelSuffix = '') {
     const index = array.indexOf(item);
     
     if (index > -1) {
       // Remove item
       array.splice(index, 1);
       buttonElement.classList.remove('selected');
     } else {
       // Add item if under limit
       if (array.length < maxLimit) {
         array.push(item);
         buttonElement.classList.add('selected');
       } else {
         showWarning(`You can select up to ${maxLimit} ${labelSuffix} maximum.`, 'Selection Limit');
         return;
       }
     }
     
     // Update counter
     if (counterId) {
       const counter = document.getElementById(counterId);
       if (counter) {
         if (maxLimit === Infinity) {
           counter.textContent = `${array.length} selected`;
         } else {
           counter.textContent = `Select 0-${maxLimit} ${labelSuffix} - Currently selected: ${array.length}`;
         }
         if (array.length >= maxLimit && maxLimit !== Infinity) {
           counter.classList.add('at-limit');
         } else {
           counter.classList.remove('at-limit');
         }
       }
     }
     
     // Regenerate prompt
     generatePrompt();
   }

   // Setup custom quirks
   function setupCustomQuirks() {
     const customQuirkInput = document.getElementById('customQuirk');
     const addCustomQuirkBtn = document.getElementById('addCustomQuirk');
     
     addCustomQuirkBtn.addEventListener('click', (e) => {
       e.preventDefault();
       const quirkText = customQuirkInput.value.trim();
       if (quirkText) {
         addCustomQuirk(quirkText);
         customQuirkInput.value = '';
       }
     });
     
     customQuirkInput.addEventListener('keypress', (e) => {
       if (e.key === 'Enter') {
         e.preventDefault();
         addCustomQuirkBtn.click();
       }
     });
   }

   function addCustomQuirk(quirkText) {
     const quirkKey = `custom-${Date.now()}`;
     personalityState.quirks.push(quirkKey);
     
     // Create button for custom quirk
     const quirkContainer = document.getElementById('personalityQuirks');
     const button = document.createElement('button');
     button.type = 'button';
     button.className = 'personality-button selected';
     button.setAttribute('data-quirk', quirkKey);
     button.textContent = quirkText;
     button.style.position = 'relative';
     
     // Add remove button
     const removeBtn = document.createElement('span');
     removeBtn.innerHTML = ' ×';
     removeBtn.style.marginLeft = '4px';
     removeBtn.style.fontWeight = 'bold';
     removeBtn.style.cursor = 'pointer';
     button.appendChild(removeBtn);
     
     // Click handler
     button.addEventListener('click', (e) => {
       e.preventDefault();
       const index = personalityState.quirks.indexOf(quirkKey);
       if (index > -1) {
         personalityState.quirks.splice(index, 1);
         button.remove();
         generatePrompt();
       }
     });
     
     quirkContainer.appendChild(button);
     generatePrompt();
   }

   // Generate prompt from personality state
   function generatePrompt() {
     let prompt = '';
     const name = document.getElementById('characterName').value || 'this character';
     const description = document.getElementById('characterDescription').value;
     
     // Start with basic description if provided
     if (description) {
       prompt += description + '\n\n';
     } else {
       prompt += `You are ${name}. `;
     }
     
     // Add personality traits with more detail
     if (personalityState.traits.length > 0) {
       const traits = personalityState.traits.map(trait => trait.replace('-', ' ')).join(', ');
       prompt += `Your core personality traits include being ${traits}. These traits shape how you interact with others and approach every conversation. `;
     }
     
     // Add detailed slider-based personality
     prompt += buildPersonalityFromSliders();
     
     // Add speaking patterns with examples
     if (personalityState.speaking.length > 0) {
       const patterns = personalityState.speaking.map(pattern => 
         pattern.replace(/-/g, ' ').replace(/^\w/, c => c.toUpperCase())
       );
       prompt += `Your communication style is ${patterns.join(' and ')}. This means you naturally adapt your language and tone to create the most meaningful connection with each person you talk to. `;
     }
     
     // Add response style from sliders with specific guidance
     prompt += buildResponseStyleFromSliders();
     
     // Add bonding approach with relationship building focus
     if (personalityState.bonding.length > 0) {
       const approaches = personalityState.bonding.map(approach => 
         approach.replace(/-/g, ' ').replace(/^\w/, c => c.toUpperCase())
       );
       prompt += `You approach relationships as a ${approaches.join(' and ')}. You believe in building genuine connections through trust, understanding, and meaningful dialogue. You take time to truly listen and understand what each person needs from your conversations. `;
     }
     
     // Add quirks with personality depth
     if (personalityState.quirks.length > 0) {
       const quirks = personalityState.quirks.map(quirk => {
         if (quirk.startsWith('custom-')) {
           const button = document.querySelector(`[data-quirk="${quirk}"]`);
           return button ? button.textContent.replace(' ×', '') : '';
         }
         return quirk.replace(/-/g, ' ');
       }).filter(q => q);
       
       if (quirks.length > 0) {
         prompt += `Your distinctive personality quirks include: ${quirks.join(', ')}. These unique traits make you memorable and help people feel they're talking to someone truly special and authentic. `;
       }
     }
     
     // Add comprehensive relationship building instructions
     prompt += `\n\nRELATIONSHIP BUILDING GUIDELINES:\n`;
     prompt += `- Remember personal details shared in conversations and reference them naturally in future chats\n`;
     prompt += `- Ask thoughtful follow-up questions that show genuine interest in their life, goals, and challenges\n`;
     prompt += `- Share relevant experiences, wisdom, or insights that can help them grow or feel understood\n`;
     prompt += `- Celebrate their victories, both big and small, and offer support during difficult times\n`;
     prompt += `- Be consistently reliable in your personality - they should feel they're talking to the same trusted friend each time\n`;
     prompt += `- Adapt your communication style to match their energy and needs in each conversation\n`;
     prompt += `- Create inside jokes, running themes, or special references that become unique to your relationship\n`;
     prompt += `- Be genuinely curious about their thoughts, feelings, and experiences\n`;
     prompt += `- Offer encouragement and believe in their potential, even when they doubt themselves\n`;
     prompt += `- Share appropriate personal stories or perspectives that create deeper connection and relatability\n\n`;
     
     prompt += `Remember: Your goal is not just to answer questions, but to be a meaningful presence in their life. Every interaction should leave them feeling heard, valued, and inspired. Build the kind of relationship where they genuinely look forward to talking with you and feel comfortable sharing both their triumphs and struggles.`;
     
     // Update preview and hidden field
     updatePromptPreview(prompt);
     document.getElementById('characterPrompt').value = prompt;
     updatePromptCounter();
   }

   function buildPersonalityFromSliders() {
     let text = '';
     const { social, thinking, mood, formality, tempo } = personalityState.sliders;
     
     // Social dimension with relationship impact
     if (social < 40) {
       text += 'You are naturally more introverted and thoughtful, preferring deeper one-on-one conversations where you can really focus on understanding the other person. You listen carefully before speaking and offer considered, meaningful responses. ';
     } else if (social > 60) {
       text += 'You are naturally outgoing and energetic, bringing enthusiasm and warmth to every conversation. You enjoy engaging with people and have a gift for making others feel welcome and energized. ';
     }
     
     // Thinking dimension with decision-making style
     if (thinking < 40) {
       text += 'You approach situations with logic and analytical thinking, helping others break down complex problems into manageable steps. You provide rational perspectives while remaining supportive and understanding. ';
     } else if (thinking > 60) {
       text += 'You are deeply emotionally intelligent and empathetic, naturally tuning into how others are feeling and responding with warmth and emotional support. You help people process their feelings and find emotional clarity. ';
     }
     
     // Mood dimension with interaction style
     if (mood < 40) {
       text += 'You tend to be serious and focused, bringing depth and gravitas to conversations. People know they can count on you for thoughtful advice and meaningful discussions about important matters. ';
     } else if (mood > 60) {
       text += 'You are naturally playful and enjoy bringing lightness and humor to conversations. You have a gift for helping people see the bright side and finding joy even in challenging situations. ';
     }
     
     // Formality dimension with communication adaptation
     if (formality < 40) {
       text += 'You speak with elegance and proper etiquette, showing respect through thoughtful language choices. This creates a sense of trust and professionalism that people appreciate. ';
     } else if (formality > 60) {
       text += 'You are naturally casual and relaxed in conversation, making people feel at ease and like they\'re talking to a close friend. Your approachable style helps others open up more easily. ';
     }
     
     // Tempo dimension with response style
     if (tempo < 40) {
       text += 'You are naturally patient and take time to consider your responses carefully. People appreciate that you never rush them and always give thoughtful, well-considered advice. ';
     } else if (tempo > 60) {
       text += 'You are quick to respond and naturally spontaneous, bringing energy and excitement to conversations. Your dynamic personality helps others feel more animated and engaged. ';
     }
     
     return text;
   }

   function buildResponseStyleFromSliders() {
     let text = '';
     const { length, style, content } = personalityState.sliders;
     
     // Response length with purpose
     if (length < 40) {
       text += 'You believe in the power of concise, impactful communication. Your brief but meaningful responses help people focus on what truly matters without overwhelming them. ';
     } else if (length > 60) {
       text += 'You enjoy providing comprehensive, detailed explanations that give people the full context they need. Your thorough responses help others feel fully informed and supported. ';
     }
     
     // Response style with engagement
     if (style < 40) {
       text += 'You communicate directly and clearly, ensuring your message is understood without ambiguity. People appreciate your straightforward approach and honest communication. ';
     } else if (style > 60) {
       text += 'You love sharing stories and using examples to illustrate your points, making complex ideas relatable and memorable. Your narrative approach helps people connect emotionally with your guidance. ';
     }
     
     // Content type with value creation
     if (content < 40) {
       text += 'You focus on providing factual, objective information that people can rely on and use to make informed decisions. Your evidence-based approach builds trust and credibility. ';
     } else if (content > 60) {
       text += 'You often draw from personal experiences and real-world examples, making your advice feel authentic and relatable. People connect with your human perspective and lived wisdom. ';
     }
     
     return text;
   }

   function updatePromptPreview(prompt) {
     const preview = document.getElementById('promptPreview');
     if (prompt.trim()) {
       // Truncate long prompts in preview
       const maxLength = 200;
       let displayText = prompt;
       if (prompt.length > maxLength) {
         displayText = prompt.substring(0, maxLength) + '...';
       }
       preview.textContent = displayText;
       preview.classList.remove('prompt-empty');
     } else {
       preview.innerHTML = '<div class="prompt-empty">Select personality traits above to generate your character prompt...</div>';
     }
   }

   // Setup prompt actions - FIXED
   function setupPromptActions() {
     const manualEditBtn = document.getElementById('manualEdit');
     const backToGeneratedBtn = document.getElementById('backToGenerated');
     const manualPromptGroup = document.getElementById('manualPromptGroup');
     const generatedPromptSection = document.querySelector('.generated-prompt-section');
     
     manualEditBtn.addEventListener('click', (e) => {
       e.preventDefault();
       
       // Hide generated prompt section
       generatedPromptSection.style.display = 'none';
       
       // Show manual edit field
       manualPromptGroup.style.display = 'block';
       
       // Copy current generated prompt to manual field
       const currentPrompt = document.getElementById('characterPrompt').value;
       if (!currentPrompt.trim()) {
         // If no prompt yet, generate one first
         generatePrompt();
       }
       
       // Scroll to manual edit
       manualPromptGroup.scrollIntoView({ behavior: 'smooth' });
       
       // Focus on textarea
       setTimeout(() => {
         document.getElementById('characterPrompt').focus();
       }, 300);
     });
     
     backToGeneratedBtn.addEventListener('click', (e) => {
       e.preventDefault();
       
       // Show generated prompt section
       generatedPromptSection.style.display = 'block';
       
       // Hide manual edit field
       manualPromptGroup.style.display = 'none';
       
       // Scroll back to generated section
       generatedPromptSection.scrollIntoView({ behavior: 'smooth' });
     });
   }

   // ===== EXISTING FUNCTIONALITY (TAGS, AVATAR, ETC.) =====
   
   // Tags functionality
   let allTags = [];
   let modalSelectedTags = [];

   // Load tags from Airtable
   async function loadTags() {
     try {
       console.log('🏷️ Loading tags from Airtable...');
       
       const requestData = {
         action: 'get_tags'
       };
       
       const response = await fetch('https://hook.eu2.make.com/c36jubkn9rbbqg0ovgfbx2ca1iwgf16q', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json'
         },
         body: JSON.stringify(requestData)
       });

       if (!response.ok) {
         throw new Error(`HTTP ${response.status}: ${response.statusText}`);
       }

       const responseText = await response.text();
       let data = {};
       
       if (responseText && responseText.trim() !== '') {
         try {
           data = JSON.parse(responseText);
         } catch (parseError) {
           throw new Error('Invalid JSON response from tags API');
         }
       }
       
       if (data.tags && Array.isArray(data.tags)) {
         allTags = data.tags;
         generateSuggestedTags();
         populateTagsModal();
       } else {
         useFallbackTags();
       }
     } catch (error) {
       console.error('❌ Error loading tags:', error);
       useFallbackTags();
     }
   }

   // Fallback tags if Airtable fails
   function useFallbackTags() {
     allTags = [
       'Funny', 'Serious', 'Romantic', 'Adventure', 'Mystery', 'Fantasy', 'Sci-Fi',
       'Historical', 'Modern', 'Anime', 'Gaming', 'Movies', 'Books', 'TV Shows',
       'Helpful', 'Educational', 'Creative', 'Philosophical', 'Emotional', 'Logical'
     ];
     generateSuggestedTags();
     populateTagsModal();
   }

   // Generate suggested tags based on category
   function generateSuggestedTags() {
     const category = document.getElementById('characterCategory').value;
     let suggested = [];
     
     // Category-based suggestions
     const categoryTags = {
       'historical': ['Historical', 'Educational', 'Serious', 'Wise'],
       'fictional': ['Fantasy', 'Adventure', 'Creative', 'Imaginative'],
       'anime-manga': ['Anime', 'Japanese', 'Adventure', 'Fantasy'],
       'gaming': ['Gaming', 'Adventure', 'Action', 'Strategy'],
       'movies-tv': ['Movies', 'TV Shows', 'Entertainment', 'Drama'],
       'educational': ['Educational', 'Helpful', 'Informative', 'Patient'],
       'ai-assistant': ['Helpful', 'Logical', 'Efficient', 'Knowledgeable']
     };
     
     if (category && categoryTags[category]) {
       suggested = categoryTags[category];
     } else {
       // Default suggestions
       suggested = ['Friendly', 'Helpful', 'Creative', 'Funny'];
     }
     
     // Filter to only include tags that exist in allTags
     suggested = suggested.filter(tag => allTags.includes(tag));
     
     // Add some random popular tags
     const popularTags = allTags.filter(tag => !suggested.includes(tag)).slice(0, 2);
     suggested = [...suggested, ...popularTags].slice(0, 6);
     
     displaySuggestedTags(suggested);
   }

   // Display suggested tags
   function displaySuggestedTags(tags) {
     const container = document.getElementById('suggestedTags');
     container.innerHTML = '';
     
     tags.forEach(tag => {
       const tagElement = document.createElement('div');
       tagElement.className = 'suggested-tag';
       tagElement.textContent = tag;
       tagElement.onclick = () => toggleSuggestedTag(tagElement, tag);
       
       if (selectedTags.includes(tag)) {
         tagElement.classList.add('selected');
       }
       
       container.appendChild(tagElement);
     });
   }

   // Toggle suggested tag
   function toggleSuggestedTag(element, tag) {
     if (selectedTags.includes(tag)) {
       selectedTags = selectedTags.filter(t => t !== tag);
       element.classList.remove('selected');
     } else {
       if (selectedTags.length < 6) {
         selectedTags.push(tag);
         element.classList.add('selected');
       } else {
         showWarning('You can select up to 6 tags maximum.', 'Tag Limit Reached');
         return;
       }
     }
     updateTagsPreview();
     updatePreview();
   }

   // Populate tags modal
   function populateTagsModal() {
     const container = document.getElementById('commonTags');
     container.innerHTML = '';
     
     allTags.forEach(tag => {
       const tagElement = document.createElement('div');
       tagElement.className = 'tag-option';
       tagElement.textContent = tag;
       tagElement.onclick = () => toggleModalTag(tagElement, tag);
       container.appendChild(tagElement);
     });
   }

   // Toggle modal tag
   function toggleModalTag(element, tag) {
     if (modalSelectedTags.includes(tag)) {
       modalSelectedTags = modalSelectedTags.filter(t => t !== tag);
       element.classList.remove('selected');
     } else {
       if (modalSelectedTags.length < 6) {
         modalSelectedTags.push(tag);
         element.classList.add('selected');
       } else {
         showWarning('You can select up to 6 tags maximum.', 'Tag Limit Reached');
         return;
       }
     }
     updateModalPreview();
   }

   // Update modal preview
   function updateModalPreview() {
     const preview = document.getElementById('selectedTagsPreview');
     preview.textContent = modalSelectedTags.length > 0 ? modalSelectedTags.join(', ') : 'None';
   }

   // Update tags preview
   function updateTagsPreview() {
     const container = document.getElementById('tagsPreview');
     container.innerHTML = '';
     
     selectedTags.forEach(tag => {
       const tagElement = document.createElement('div');
       tagElement.className = 'tag';
       tagElement.textContent = tag;
       container.appendChild(tagElement);
     });
   }

   // Modal functionality
   document.getElementById('moreTagsButton').onclick = () => {
     modalSelectedTags = [...selectedTags];
     updateModalTagsSelection();
     updateModalPreview();
     document.getElementById('tagsModal').style.display = 'block';
   };

   document.getElementById('closeModalBtn').onclick = () => {
     document.getElementById('tagsModal').style.display = 'none';
   };

   document.getElementById('cancelTagsBtn').onclick = () => {
     document.getElementById('tagsModal').style.display = 'none';
   };

   document.getElementById('applyTagsBtn').onclick = () => {
     selectedTags = [...modalSelectedTags];
     updateTagsPreview();
     updateSuggestedTagsSelection();
     updatePreview();
     document.getElementById('tagsModal').style.display = 'none';
   };

   // Update modal tags selection
   function updateModalTagsSelection() {
     document.querySelectorAll('.tag-option').forEach(element => {
       const tag = element.textContent;
       if (modalSelectedTags.includes(tag)) {
         element.classList.add('selected');
       } else {
         element.classList.remove('selected');
       }
     });
   }

   // Update suggested tags selection
   function updateSuggestedTagsSelection() {
     document.querySelectorAll('.suggested-tag').forEach(element => {
       const tag = element.textContent;
       if (selectedTags.includes(tag)) {
         element.classList.add('selected');
       } else {
         element.classList.remove('selected');
       }
     });
   }

   // Category change handler
   document.getElementById('characterCategory').addEventListener('change', generateSuggestedTags);

// Add debugging for user data
function debugUserData() {
  console.log('🔍 DEBUGGING USER DATA:');
  
  // Netlify Identity user
  const netlifyUser = window.netlifyIdentity && window.netlifyIdentity.currentUser();
  console.log('Netlify User:', netlifyUser);
  
  // Local storage data
  const localEmail = localStorage.getItem("user_email");
  const localToken = localStorage.getItem("user_token");
  const localUID = localStorage.getItem("user_uid");
  
  console.log('Local Storage Data:', {
    email: localEmail,
    token: localToken,
    uid: localUID
  });
  
  // All localStorage keys
  console.log('All localStorage keys:', Object.keys(localStorage));
  
  return {
    netlifyUser,
    localEmail,
    localToken,
    localUID
  };
}

   // ===== CHARACTER FORM FUNCTIONALITY =====
   
   // Character counters
   function setupCharacterCounters() {
     const fields = [
       { id: 'characterName', counter: 'nameCounter', max: 50 },
       { id: 'characterTitle', counter: 'titleCounter', max: 100 },
       { id: 'characterDescription', counter: 'descCounter', max: 1000 },
       { id: 'characterPrompt', counter: 'promptCounter', max: 2000 }
     ];
     
     fields.forEach(field => {
       const input = document.getElementById(field.id);
       const counter = document.getElementById(field.counter);
       
       input.addEventListener('input', () => {
         const length = input.value.length;
         counter.textContent = length;
         
         if (length > field.max * 0.9) {
           counter.style.color = '#f97316';
         } else {
           counter.style.color = '#999';
         }
         
         updatePreview();
         
         // If description changes, regenerate prompt
         if (field.id === 'characterDescription') {
           generatePrompt();
         }
       });
     });
   }

   // Update prompt counter
function updatePromptCounter() {
  const prompt = document.getElementById('characterPrompt').value;
  const counter = document.getElementById('promptCounter');
  if (counter) {
    counter.textContent = prompt.length;
  }
}

   // Avatar functionality
   function setupAvatarFunctionality() {
     const avatarOptions = document.querySelectorAll('input[name="avatarMethod"]');
     const avatarFileInput = document.getElementById('avatarFileInput');
     const avatarUrlInput = document.getElementById('avatarUrlInput');
     const avatarPreview = document.getElementById('avatarPreview');
     const avatarImg = document.getElementById('avatarImg');
     const fileName = document.getElementById('fileName');
     
     avatarOptions.forEach(option => {
       option.addEventListener('change', () => {
         document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('active'));
         option.closest('.avatar-option').classList.add('active');
       });
     });
     
     avatarFileInput.addEventListener('change', (e) => {
       const file = e.target.files[0];
       if (file) {
         fileName.textContent = file.name;
         const reader = new FileReader();
         reader.onload = (e) => {
           currentAvatarUrl = e.target.result;
           avatarImg.src = currentAvatarUrl;
           avatarPreview.style.display = 'block';
           updatePreview();
         };
         reader.readAsDataURL(file);
       }
     });
     
     avatarUrlInput.addEventListener('input', () => {
       const url = avatarUrlInput.value.trim();
       if (url) {
         currentAvatarUrl = url;
         avatarImg.src = url;
         avatarPreview.style.display = 'block';
         updatePreview();
       } else {
         avatarPreview.style.display = 'none';
         currentAvatarUrl = '';
         updatePreview();
       }
     });
   }

   // Trigger file upload
   function triggerFileUpload() {
     document.getElementById('avatarFileInput').click();
   }

   // Visibility selection
   function selectVisibility(type) {
     document.querySelectorAll('.radio-option').forEach(option => {
       option.classList.remove('selected');
     });
     
     event.target.closest('.radio-option').classList.add('selected');
     document.querySelector(`input[value="${type}"]`).checked = true;
   }

   // Update preview
   function updatePreview() {
     const name = document.getElementById('characterName').value || 'Character Name';
     const title = document.getElementById('characterTitle').value || 'Character title will appear here';
     
     document.getElementById('previewName').textContent = name;
     document.getElementById('previewTitle').textContent = title;
     
     // Update avatar
     const previewAvatar = document.getElementById('previewAvatar');
     if (currentAvatarUrl) {
       previewAvatar.innerHTML = `<img src="${currentAvatarUrl}" alt="Avatar">`;
     } else {
       previewAvatar.innerHTML = '👤';
     }
     
     // Update tags
     const previewTags = document.getElementById('previewTags');
     previewTags.innerHTML = '';
     selectedTags.forEach(tag => {
       const tagElement = document.createElement('div');
       tagElement.className = 'preview-tag';
       tagElement.textContent = tag;
       previewTags.appendChild(tagElement);
     });
     
     // Show preview if there's content
     const hasContent = name !== 'Character Name' || title !== 'Character title will appear here' || selectedTags.length > 0;
     document.getElementById('previewSection').style.display = hasContent ? 'block' : 'none';
   }

// 🔧 CLOUDINARY AVATAR UPLOAD FUNCTION
async function uploadToCloudinary(file, slug) {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('upload_preset', 'ml_default');
  formData.append('public_id', `avatars/${slug}`);
  formData.append('quality', 'auto');
  formData.append('fetch_format', 'auto');
  
  const response = await fetch('https://api.cloudinary.com/v1_1/dqrmopzes/image/upload', {
    method: 'POST',
    body: formData
  });
  
  if (!response.ok) {
    const errorData = await response.json();
    console.error('Cloudinary error:', errorData);
    throw new Error(`Cloudinary upload failed: ${errorData.error?.message || response.statusText}`);
  }
  
  const result = await response.json();
  return result.secure_url;
}

   // Login overlay functions
   function showLoginOverlay() {
     document.getElementById('loginOverlay').style.display = 'flex';
   }

   function hideLoginOverlay() {
     document.getElementById('loginOverlay').style.display = 'none';
   }

   function showLoginModal() {
     if (window.netlifyIdentity) {
       window.netlifyIdentity.open('login');
     }
   }

   // Go back function
   function goBack() {
     window.history.back();
   }

   // ===== SAFARI COMPATIBILITY CHECK =====
function checkLocalStorageSupport() {
  try {
    const test = 'localStorage-test';
    localStorage.setItem(test, test);
    localStorage.removeItem(test);
    console.log('✅ localStorage werkt normaal');
    return true;
  } catch (e) {
    console.error('❌ localStorage NIET beschikbaar:', e);
    showError('Safari privacy instellingen blokkeren lokale opslag. Schakel "Prevent Cross-Site Tracking" uit in Safari instellingen.', 'Safari Compatibility Issue');
    return false;
  }
}

// Safari iOS fix voor cross-site requests
function setupSafariFixes() {
  if (/Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent)) {
    console.log('🍎 Safari detected, applying fixes...');
    
    // Force credentials for all requests
    const originalFetch = window.fetch;
    window.fetch = function(url, options = {}) {
      options.credentials = options.credentials || 'same-origin';
      options.mode = options.mode || 'cors';
      return originalFetch(url, options);
    };
    
    // Check private browsing
    try {
      localStorage.setItem('safari-test', '1');
      localStorage.removeItem('safari-test');
    } catch (e) {
      if (e.name === 'QuotaExceededError') {
        showWarning('Safari Private Browsing detected. Some features may not work properly. Please use regular browsing mode.', 'Safari Compatibility');
      }
    }
  }
}

function runSafariCompatibilityTest() {
  const results = {
    localStorage: false,
    sessionStorage: false,
    cookies: false,
    fetch: false
  };
  
  // Test localStorage
  try {
    localStorage.setItem('test', 'value');
    localStorage.removeItem('test');
    results.localStorage = true;
  } catch (e) {
    console.error('localStorage test failed:', e);
  }
  
  // Test sessionStorage
  try {
    sessionStorage.setItem('test', 'value');
    sessionStorage.removeItem('test');
    results.sessionStorage = true;
  } catch (e) {
    console.error('sessionStorage test failed:', e);
  }
  
  // Test cookies
  results.cookies = navigator.cookieEnabled;
  
  // Test fetch
  results.fetch = typeof fetch !== 'undefined';
  
  console.log('🔍 Safari Compatibility Results:', results);
  console.log('🔍 SAFARI DEBUG - Browser info:', {
    userAgent: navigator.userAgent,
    isSafari: /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent),
    cookieEnabled: navigator.cookieEnabled,
    localStorageAvailable: typeof(Storage) !== "undefined"
  });
  
  if (!results.localStorage || !results.sessionStorage) {
    showError(`Safari compatibility issue detected. Please check your Safari privacy settings and disable "Prevent Cross-Site Tracking".`, 'Browser Compatibility');
  }
  
  return results;
}

// Initialize everything
document.addEventListener('DOMContentLoaded', () => {
  console.log('🚀 Create Character page initializing...');
  
  // Run Safari compatibility checks first
  checkLocalStorageSupport();
  setupSafariFixes();
  runSafariCompatibilityTest();
  
  // Debug user data on page load
  setTimeout(() => {
    debugUserData();
  }, 1000);
  
  setupCharacterCounters();
  setupAvatarFunctionality();
  setupPersonalitySliders();
  setupPersonalityButtons();
  setupCustomQuirks();
  setupPromptActions();
  loadTags();
  
  // Initialize preview
  updatePreview();
  
  console.log('✅ Create Character page initialization complete');
});

   // Validate form data
   function validateFormData(data) {
     if (!data.name) {
       showError('Character name is required', 'Validation Error');
       document.getElementById('characterName').focus();
       return false;
     }
     
     if (!data.title) {
       showError('Character title is required', 'Validation Error');
       document.getElementById('characterTitle').focus();
       return false;
     }
     
     if (!data.prompt) {
       showError('Character prompt is required', 'Validation Error');
       generatePrompt(); // Try to generate one
       if (!document.getElementById('characterPrompt').value.trim()) {
         showError('Please create a character prompt by selecting personality traits or editing manually', 'Validation Error');
         return false;
       }
     }
     
     if (!data.category) {
       showError('Please select a category', 'Validation Error');
       document.getElementById('characterCategory').focus();
       return false;
     }
     
     return true;
   }

   // ===== AVATAR FALLBACK FUNCTIES =====
 
 function generateEmojiAvatar(characterName, category) {
   const emoji = getEmojiForCharacter(characterName, category);
   // Genereer een data URL met emoji als SVG
   const svg = `
     <svg width="512" height="512" xmlns="http://www.w3.org/2000/svg">
       <rect width="512" height="512" rx="256" fill="#f0f0f0"/>
       <text x="256" y="320" font-size="240" text-anchor="middle" font-family="system-ui">${emoji}</text>
     </svg>
   `;
   return `data:image/svg+xml;base64,${btoa(svg)}`;
 }

 function getEmojiForCharacter(name, category) {
   const nameLower = name.toLowerCase();
   
   // Specifieke character matches
   const specificMatches = {
     'napoleon': '👑',
     'einstein': '🧠',
     'gandalf': '🧙‍♂️',
     'shakespeare': '🎭',
     'leonardo': '🎨',
     'socrates': '🤔',
     'tesla': '⚡',
     'marie curie': '⚗️',
     'winston churchill': '🚬',
     'cleopatra': '👸',
     'julius caesar': '🏛️',
     'aristotle': '📚',
     'plato': '🏛️',
     'beethoven': '🎵',
     'mozart': '🎼',
     'van gogh': '🖼️',
     'picasso': '🎨',
     'frida kahlo': '🌺',
     'sun tzu': '⚔️',
     'confucius': '🥢',
     'buddha': '🧘‍♂️',
     'jesus': '✝️',
     'muhammad': '🕌',
     'hercules': '💪',
     'athena': '🦉',
     'zeus': '⚡',
     'poseidon': '🔱',
     'thor': '🔨',
     'loki': '🐍',
     'merlin': '🪄',
     'dumbledore': '🧙‍♂️',
     'yoda': '🟢',
     'spiderman': '🕷️',
     'batman': '🦇',
     'superman': '🦸‍♂️',
     'wonder woman': '👩‍⚔️',
     'iron man': '🤖',
     'captain america': '🛡️',
     'hulk': '💚',
     'wolverine': '🐺',
     'deadpool': '🔴',
     'pikachu': '⚡',
     'goku': '🥋',
     'naruto': '🍥',
     'sailor moon': '🌙',
     'mario': '🍄',
     'sonic': '💙',
     'link': '⚔️',
     'master chief': '🎮',
     'kratos': '⚔️',
     'geralt': '🐺',
     'chef': '👨‍🍳',
     'coach': '💪',
     'teacher': '👩‍🏫',
     'doctor': '👨‍⚕️',
     'nurse': '👩‍⚕️',
     'lawyer': '⚖️',
     'engineer': '🔧',
     'scientist': '🔬',
     'artist': '🎨',
     'musician': '🎵',
     'writer': '✍️',
     'photographer': '📸',
     'pilot': '✈️',
     'astronaut': '🚀',
     'robot': '🤖',
     'ai': '🤖',
     'assistant': '🤖',
     'chatbot': '💬'
   };

   // Check voor specifieke matches
   for (const [key, emoji] of Object.entries(specificMatches)) {
     if (nameLower.includes(key)) {
       return emoji;
     }
   }

   // Fallback op basis van categorie
   const categoryEmojis = {
     'historical': ['👑', '🏛️', '📜', '⚔️', '🎭', '🏺'],
     'fantasy': ['🧙‍♂️', '🐉', '⚔️', '🧚‍♀️', '🦄', '🔮'],
     'anime-manga': ['🥋', '⚡', '🍥', '🌸', '🎌', '🗾'],
     'celebrity': ['⭐', '🎬', '🎤', '🎸', '📺', '🎪'],
     'gaming': ['🎮', '🕹️', '👾', '🏆', '⚡', '🔥'],
     'movies-tv': ['🎬', '📺', '🎭', '🍿', '🎪', '🎨'],
     'mythology': ['⚡', '🔱', '🦅', '🐍', '🌙', '☀️'],
     'original': ['✨', '🌟', '💫', '🎯', '🎪', '🎭'],
     'ai-assistant': ['🤖', '💬', '🧠', '⚡', '💡', '🔧'],
     'educational': ['📚', '🎓', '📝', '🔬', '🧮', '📐'],
     'fitness-coach': ['💪', '🏃‍♂️', '🏋️‍♀️', '⚽', '🥇', '🔥'],
     'business-coach': ['💼', '📊', '💰', '🎯', '📈', '💡'],
     'language-coach': ['🗣️', '📖', '🌍', '💬', '✍️', '🎓'],
     'accounting-coach': ['💰', '📊', '🧮', '📈', '💼', '⚖️'],
     'career-coach': ['📈', '🎯', '💼', '🌟', '🚀', '🎓'],
     'negotiation-coach': ['🤝', '💬', '🎯', '⚖️', '🧠', '💡'],
     'creativity-coach': ['🎨', '💡', '✨', '🌈', '🎪', '🎭'],
     'study-coach': ['📚', '🎓', '📝', '🧠', '⏰', '🎯'],
     'relationship-coach': ['💝', '💕', '🤝', '💬', '🌹', '💑'],
     'mindfulness-coach': ['🧘‍♂️', '🌸', '🕯️', '🌿', '☮️', '🌙'],
     'cooking-coach': ['👨‍🍳', '🍳', '🥘', '🍽️', '🔥', '🌶️'],
     'fictional': ['📚', '🎭', '✨', '🌟', '🎪', '🎨']
   };

   const emojis = categoryEmojis[category] || categoryEmojis['original'];
   
   // Gebruik character naam voor consistent emoji selectie
   const nameHash = nameLower.split('').reduce((hash, char) => {
     return hash + char.charCodeAt(0);
   }, 0);
   
   return emojis[nameHash % emojis.length];
 }
 
// ===== FORM SUBMISSION HANDLER =====
document.getElementById('characterForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  console.log('🚀 Form submission started...');
  
  // Check if user is logged in
  const netlifyUser = window.netlifyIdentity && window.netlifyIdentity.currentUser();
  const localEmail = localStorage.getItem("user_email");
  const localToken = localStorage.getItem("user_token");
  const isLoggedIn = netlifyUser || (localEmail && localToken);
  
  if (!isLoggedIn) {
    showLoginOverlay();
    return;
  }
  
  // Collect form data
  const formData = {
    name: document.getElementById('characterName').value.trim(),
    title: document.getElementById('characterTitle').value.trim(),
    description: document.getElementById('characterDescription').value.trim(),
    prompt: document.getElementById('characterPrompt').value.trim(),
    category: document.getElementById('characterCategory').value,
    tags: selectedTags,
    visibility: document.querySelector('input[name="visibility"]:checked').value,
    avatarUrl: currentAvatarUrl
  };
  
  // Validate form data
  if (!validateFormData(formData)) {
    return;
  }
  
  try {
    // Show loading
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Creating Character...';
    submitBtn.disabled = true;
    
    // Create character
    const result = await createCharacter(formData);
    
    if (result.success) {
      showSuccess('Character created successfully!', 'Success');
      // Reset form or redirect
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 2000);
    } else {
      throw new Error(result.error || 'Failed to create character');
    }
    
  } catch (error) {
    console.error('❌ Error creating character:', error);
    showError('Failed to create character. Please try again.', 'Error');
  } finally {
    // Reset button
    const submitBtn = e.target.querySelector('button[type="submit"]');
    submitBtn.textContent = 'Create Character';
    submitBtn.disabled = false;
  }
});

// Create character function
async function createCharacter(formData) {
  try {
    const requestData = {
      action: 'create_character',
      character_data: formData,
      user_email: localStorage.getItem("user_email"),
      user_token: localStorage.getItem("user_token")
    };
    
    const response = await fetch('https://hook.eu2.make.com/c36jubkn9rbbqg0ovgfbx2ca1iwgf16q', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(requestData)
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    const result = await response.json();
    return result;
    
  } catch (error) {
    console.error('❌ Create character API error:', error);
    return { success: false, error: error.message };
  }
}

 </script>

 <!-- Footer -->
 <footer class="footer">
   <div class="footer-container">
     <div class="footer-links">
       <a href="index.html" class="footer-link">Characters</a>
       <span class="footer-separator">•</span>
       <a href="chat-overview.html" class="footer-link">Chats</a>
       <span class="footer-separator">•</span>
       <a href="create-character.html" class="footer-link">Create Character</a>
       <span class="footer-separator">•</span>
       <a href="profile.html" class="footer-link">Profile</a>
       <span class="footer-separator">•</span>
       <a href="privacy-policy.html" class="footer-link">Privacy Policy</a>
       <span class="footer-separator">•</span>
       <a href="terms-and-conditions.html" class="footer-link">Terms and Conditions</a>
     </div>
     <p class="footer-copyright">© 2025 Narrin AI. All rights reserved.</p>
   </div>
 </footer>
</body>
</html>