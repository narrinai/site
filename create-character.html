<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create AI Character | Custom Character Builder - Narrin AI</title>
  
  <!-- Import Modern Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    /* ===== CSS CUSTOM PROPERTIES ===== */
    :root {
      /* Primary Colors */
      --color-white: #ffffff;
      --color-off-white: #fafafa;
      --color-light-gray: #f5f5f5;
      
      /* Accent Colors */
      --color-teal: #14b8a6;
      --color-teal-light: #5eead4;
      --color-teal-dark: #0f766e;
      --color-teal-alt: #10a394;
      --color-coral: #f97316;
      --color-coral-light: #fb923c;
      --color-coral-dark: #ea580c;
      
      /* Supporting Colors */
      --color-navy: #1e293b;
      --color-navy-light: #334155;
      --color-gray: #64748b;
      --color-gray-light: #94a3b8;
      --color-gray-dark: #475569;
      
      /* Gradients */
      --gradient-primary: linear-gradient(135deg, var(--color-teal) 0%, var(--color-coral) 100%);
      --gradient-subtle: linear-gradient(135deg, var(--color-teal-light) 0%, var(--color-coral-light) 100%);
      --gradient-tags: linear-gradient(135deg, var(--color-teal-alt) 0%, var(--color-coral) 100%);
      
      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --shadow-colored: 0 10px 25px -5px rgba(20, 184, 166, 0.2);
      
      /* Spacing */
      --spacing-xs: 0.5rem;
      --spacing-sm: 0.75rem;
      --spacing-md: 1rem;
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
      --spacing-2xl: 3rem;
      --spacing-3xl: 4rem;
      
      /* Typography */
      --font-primary: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      --font-secondary: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
      
      /* Font Sizes */
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-2xl: 1.5rem;
      --font-size-3xl: 1.875rem;
      --font-size-4xl: 2.25rem;
      
      /* Border Radius */
      --radius-sm: 6px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 9999px;
      
      /* Transitions */
      --transition-fast: 150ms ease-out;
      --transition-base: 300ms ease-out;
      --transition-slow: 500ms ease-out;
      
      /* Touch Target Size */
      --touch-target: 44px;
      
      /* Z-index Scale */
      --z-dropdown: 100;
      --z-sticky: 200;
      --z-overlay: 300;
      --z-modal: 400;
      --z-menu-overlay: 500;
    }

    /* ===== RESET & BASE STYLES ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      overflow-x: hidden;
    }

    body {
      font-family: var(--font-primary);
      background: var(--color-off-white);
      color: var(--color-navy);
      line-height: 1.6;
      font-size: var(--font-size-base);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
      width: 100%;
    }

    input, button, textarea, select {
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      z-index: 10;
      position: relative;
    }

    /* ===== ACCESSIBILITY ===== */
    :focus {
      outline: 2px solid var(--color-teal);
      outline-offset: 2px;
    }

    :focus:not(:focus-visible) {
      outline: none;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: var(--spacing-xl);
    }

    .header-page {
      text-align: center;
      margin-bottom: var(--spacing-2xl);
    }

    .header-page h1 {
      font-family: var(--font-secondary);
      font-size: var(--font-size-4xl);
      margin: 0 0 var(--spacing-md) 0;
      color: var(--color-navy);
      font-weight: 800;
      letter-spacing: -0.02em;
    }

    .header-page p {
      color: var(--color-gray);
      font-size: var(--font-size-lg);
      margin: 0;
      font-weight: 400;
    }

    .form-section {
      background: var(--color-white);
      padding: var(--spacing-2xl);
      border-radius: var(--radius-lg);
      margin-bottom: var(--spacing-xl);
      box-shadow: var(--shadow-md);
      border: 2px solid var(--color-light-gray);
      transition: all var(--transition-base);
    }

    .form-section:hover {
      border-color: var(--color-teal);
      box-shadow: var(--shadow-lg);
    }

    .form-section h2 {
      margin: 0 0 var(--spacing-lg) 0;
      font-family: var(--font-secondary);
      font-size: var(--font-size-2xl);
      color: var(--color-navy);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .form-group {
      margin-bottom: var(--spacing-xl);
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    label {
      display: block;
      margin-bottom: var(--spacing-xs);
      font-weight: 600;
      color: var(--color-navy);
      font-size: var(--font-size-sm);
    }

    input[type="text"],
    input[type="url"],
    textarea,
    select {
      width: 100%;
      padding: var(--spacing-md) var(--spacing-lg);
      font-size: var(--font-size-base);
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-md);
      box-sizing: border-box;
      font-family: var(--font-primary);
      transition: all var(--transition-base);
      background: var(--color-white);
      color: var(--color-navy);
    }

    input[type="text"]::placeholder,
    input[type="url"]::placeholder,
    textarea::placeholder {
      font-size: var(--font-size-sm);
      color: var(--color-gray-light);
    }

    input[type="text"]:focus,
    input[type="url"]:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--color-teal);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    textarea {
      resize: vertical;
      min-height: 120px;
      line-height: 1.6;
    }

    .character-prompt {
      min-height: 180px;
    }

    .char-counter {
      font-size: 12px;
      color: #999;
      text-align: right;
      margin-top: 4px;
    }

    /* ===== NEW PERSONALITY BUILDER STYLES ===== */
    
    .personality-builder {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xl);
    }

    .personality-section {
      padding: var(--spacing-xl);
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-lg);
      background: var(--color-off-white);
      margin-bottom: var(--spacing-lg);
    }

    .personality-section h3 {
      margin: 0 0 var(--spacing-lg) 0;
      font-family: var(--font-secondary);
      font-size: var(--font-size-lg);
      color: var(--color-navy);
      font-weight: 600;
      line-height: 1.4;
    }

    /* Sliders */
    .slider-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }

    .slider-item {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .slider-labels {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-xs);
    }

    .slider-label {
      font-size: var(--font-size-sm);
      color: var(--color-gray-dark);
      font-weight: 500;
    }

    .slider-container {
      position: relative;
      width: 100%;
    }

    .personality-slider {
      width: 100%;
      height: 8px;
      border-radius: var(--radius-full);
      background: var(--color-light-gray);
      outline: none;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
    }

    .personality-slider::-webkit-slider-thumb {
      appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--gradient-primary);
      cursor: pointer;
      border: 3px solid var(--color-white);
      box-shadow: var(--shadow-md);
      transition: all var(--transition-base);
    }

    .personality-slider::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-lg);
    }

    .personality-slider::-moz-range-thumb {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--gradient-primary);
      cursor: pointer;
      border: 3px solid var(--color-white);
      box-shadow: var(--shadow-md);
      transition: all var(--transition-base);
    }

    /* Button Groups */
    .button-group-personality {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
    }

    .personality-button {
      padding: var(--spacing-sm) var(--spacing-md);
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-full);
      background: var(--color-white);
      color: var(--color-navy);
      font-size: var(--font-size-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-base);
      user-select: none;
      font-family: var(--font-primary);
    }

    .personality-button:hover {
      border-color: var(--color-teal);
      background: var(--color-off-white);
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }

    .personality-button.selected {
      border-color: var(--color-teal);
      background: var(--color-teal);
      color: var(--color-white);
      box-shadow: var(--shadow-colored);
    }

    .personality-button.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Selection counters */
    .selection-counter {
      font-size: var(--font-size-xs);
      color: var(--color-gray);
      margin-top: var(--spacing-xs);
      text-align: right;
      font-style: italic;
    }

    .selection-counter.at-limit {
      color: var(--color-coral);
      font-weight: 600;
    }

    /* Generated prompt section */
    .generated-prompt-section {
      margin-top: var(--spacing-2xl);
      margin-bottom: var(--spacing-2xl);
      padding: var(--spacing-xl);
      background: var(--color-white);
      border: 2px solid var(--color-teal);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
    }

    .generated-prompt-section h3 {
      margin: 0 0 var(--spacing-lg) 0;
      font-family: var(--font-secondary);
      font-size: var(--font-size-xl);
      color: var(--color-navy);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .prompt-preview {
      background: var(--color-off-white);
      padding: var(--spacing-lg);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-light-gray);
      font-size: var(--font-size-sm);
      line-height: 1.6;
      color: var(--color-gray-dark);
      margin-bottom: var(--spacing-lg);
      min-height: 60px;
      max-height: 120px;
      overflow-y: auto;
    }

    .prompt-empty {
      color: var(--color-gray-light);
      font-style: italic;
      text-align: center;
      padding: var(--spacing-xl);
    }

    .prompt-actions {
      display: flex;
      gap: var(--spacing-md);
      align-items: center;
    }

    .manual-edit-btn, .regenerate-btn {
      padding: var(--spacing-sm) var(--spacing-lg);
      background: var(--color-white);
      color: var(--color-teal);
      border: 2px solid var(--color-teal);
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .manual-edit-btn:hover, .regenerate-btn:hover {
      background: var(--color-teal);
      color: var(--color-white);
      transform: translateY(-2px);
    }

    .manual-edit-btn:active, .regenerate-btn:active {
      background: var(--color-teal);
      color: var(--color-white);
      transform: translateY(0);
      box-shadow: var(--shadow-md);
    }

    /* Form buttons */
    .button-group {
      display: flex;
      gap: var(--spacing-md);
      margin-top: var(--spacing-2xl);
    }

    button {
      padding: var(--spacing-lg) var(--spacing-2xl);
      border: none;
      border-radius: var(--radius-full);
      font-size: var(--font-size-base);
      cursor: pointer;
      font-weight: 600;
      transition: all var(--transition-base);
      font-family: var(--font-primary);
    }

    .btn-primary-form {
      background: var(--gradient-primary);
      color: var(--color-white);
      flex: 1;
      box-shadow: var(--shadow-colored);
    }

    .btn-primary-form:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
    }

    .btn-secondary-form {
      background: var(--color-white);
      color: var(--color-navy);
      border: 2px solid var(--color-teal);
      min-width: 120px;
      box-shadow: var(--shadow-sm);
    }

    .btn-secondary-form:hover {
      background: var(--color-teal);
      color: var(--color-white);
      transform: translateY(-2px);
    }

    /* Mobile responsive adjustments */
    @media (max-width: 600px) {
      .container {
        padding: var(--spacing-lg);
      }

      .header-page h1 {
        font-size: var(--font-size-3xl);
      }

      .form-section {
        padding: var(--spacing-xl);
      }

      .button-group {
        flex-direction: column;
      }

      .slider-labels {
        font-size: var(--font-size-xs);
      }

      .button-group-personality {
        gap: var(--spacing-xs);
      }

      .personality-button {
        font-size: var(--font-size-xs);
        padding: var(--spacing-xs) var(--spacing-sm);
      }

      .prompt-actions {
        flex-direction: column;
      }
    }

    /* ===== FOOTER STYLES ===== */
    .footer {
      background: var(--color-white);
      border-top: 1px solid var(--color-light-gray);
      padding: var(--spacing-xl) 0;
      margin-top: var(--spacing-3xl);
    }

    .footer-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 var(--spacing-lg);
      text-align: center;
    }

    .footer-links {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
      flex-wrap: wrap;
    }

    .footer-link {
      color: var(--color-gray);
      text-decoration: none;
      font-size: var(--font-size-sm);
      font-weight: 500;
      transition: color var(--transition-base);
    }

    .footer-link:hover {
      color: var(--color-teal);
    }

    .footer-separator {
      color: var(--color-gray-light);
      font-size: var(--font-size-sm);
    }

    .footer-copyright {
      color: var(--color-gray-light);
      font-size: var(--font-size-xs);
      margin: 0;
    }

    /* Mobile footer adjustments */
    @media (max-width: 768px) {
      .footer {
        padding: var(--spacing-lg) 0;
        margin-top: var(--spacing-2xl);
      }

      .footer-container {
        padding: 0 var(--spacing-md);
      }

      .footer-links {
        gap: var(--spacing-md);
      }
    }

    /* ===== AVATAR STYLES ===== */
    .avatar-input-options {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }

    .avatar-option {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
      padding: var(--spacing-lg);
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-md);
      transition: border-color var(--transition-base);
      background: var(--color-white);
    }

    .avatar-option.active {
      border-color: var(--color-teal);
      background-color: var(--color-off-white);
    }

    .avatar-option input[type="radio"] {
      display: none;
    }

    .avatar-option > label {
      font-weight: 600;
      margin: 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      color: var(--color-navy);
    }

    .avatar-option > label::before {
      content: '';
      width: 16px;
      height: 16px;
      border: 2px solid var(--color-gray-light);
      border-radius: 50%;
      background: var(--color-white);
      transition: all var(--transition-base);
    }

    .avatar-option input[type="radio"]:checked + label::before {
      border-color: var(--color-teal);
      background: var(--color-teal);
      box-shadow: inset 0 0 0 3px var(--color-white);
    }

    .upload-button {
      padding: var(--spacing-sm) var(--spacing-lg);
      background-color: var(--color-light-gray);
      border: 1px solid var(--color-gray-light);
      border-radius: var(--radius-md);
      cursor: pointer;
      font-size: var(--font-size-sm);
      transition: background-color var(--transition-base);
      align-self: flex-start;
      font-family: var(--font-primary);
    }

    .upload-button:hover {
      background-color: var(--color-gray-light);
    }

    .file-name {
      font-size: var(--font-size-xs);
      color: var(--color-gray);
      margin-top: var(--spacing-xs);
      font-style: italic;
    }

    .avatar-preview {
      margin-top: var(--spacing-md);
      display: none;
    }

    .avatar-preview img {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-full);
      object-fit: cover;
      border: 3px solid var(--color-light-gray);
      transition: all var(--transition-base);
    }

    .avatar-preview img:hover {
      border-color: var(--color-teal);
      transform: scale(1.05);
    }

    /* ===== TAGS STYLES ===== */
    .suggested-tags-section {
      margin-bottom: var(--spacing-md);
    }

    .suggested-tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
    }

    .suggested-tag {
      background-color: var(--color-off-white);
      border: 2px solid var(--color-teal);
      color: var(--color-teal);
      padding: var(--spacing-xs) var(--spacing-md);
      border-radius: var(--radius-full);
      font-size: var(--font-size-sm);
      cursor: pointer;
      transition: all var(--transition-base);
      user-select: none;
      font-weight: 500;
    }

    .suggested-tag:hover {
      background-color: var(--color-teal-light);
    }

    .suggested-tag.selected {
      background-color: var(--color-teal);
      color: var(--color-white);
    }

    .more-tags-button {
      padding: var(--spacing-sm) var(--spacing-lg);
      background-color: var(--color-light-gray);
      color: var(--color-navy);
      border: 1px solid var(--color-gray-light);
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      cursor: pointer;
      transition: all var(--transition-base);
      font-family: var(--font-primary);
    }

    .more-tags-button:hover {
      background-color: var(--color-gray-light);
    }

    .tags-help {
      font-size: var(--font-size-xs);
      color: var(--color-gray);
      margin-top: var(--spacing-xs);
      font-style: italic;
    }

    .tags-preview {
      margin-top: var(--spacing-sm);
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
    }

    .tag {
      background-color: var(--color-off-white);
      color: var(--color-teal);
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--radius-full);
      font-size: var(--font-size-xs);
      font-weight: 500;
      border: 1px solid var(--color-teal);
    }

    /* Tags Modal */
    .tags-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: var(--z-modal);
      padding: var(--spacing-lg);
      box-sizing: border-box;
    }

    .tags-modal-content {
      background: var(--color-white);
      border-radius: var(--radius-lg);
      max-width: 600px;
      max-height: 80vh;
      margin: 50px auto;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-xl);
    }

    .tags-modal-header {
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--color-light-gray);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .tags-modal-header h3 {
      margin: 0;
      font-size: var(--font-size-xl);
      color: var(--color-navy);
      font-family: var(--font-secondary);
    }

    .close-modal {
      background: none;
      border: none;
      font-size: var(--font-size-2xl);
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background-color var(--transition-base);
      color: var(--color-gray);
    }

    .close-modal:hover {
      background-color: var(--color-light-gray);
    }

    .tags-modal-body {
      padding: var(--spacing-lg);
      overflow-y: auto;
      flex: 1;
    }

    .common-tags-section {
      margin-bottom: var(--spacing-xl);
    }

    .tags-modal-body h4 {
      margin: 0 0 var(--spacing-md) 0;
      font-size: var(--font-size-lg);
      color: var(--color-navy);
      font-family: var(--font-secondary);
    }

    .common-tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
    }

    .tag-option {
      background-color: var(--color-off-white);
      border: 2px solid var(--color-light-gray);
      color: var(--color-navy);
      padding: var(--spacing-xs) var(--spacing-md);
      border-radius: var(--radius-full);
      font-size: var(--font-size-sm);
      cursor: pointer;
      transition: all var(--transition-base);
      user-select: none;
    }

    .tag-option:hover {
      border-color: var(--color-teal);
    }

    .tag-option.selected {
      background-color: var(--color-teal);
      border-color: var(--color-teal);
      color: var(--color-white);
    }

    .tags-modal-footer {
      padding: var(--spacing-lg);
      border-top: 1px solid var(--color-light-gray);
      background-color: var(--color-off-white);
    }

    .selected-tags-preview {
      margin-bottom: var(--spacing-lg);
      font-size: var(--font-size-sm);
      color: var(--color-gray-dark);
    }

    .modal-buttons {
      display: flex;
      gap: var(--spacing-md);
      justify-content: flex-end;
    }

    .modal-buttons button {
      padding: var(--spacing-sm) var(--spacing-lg);
      font-size: var(--font-size-sm);
      border-radius: var(--radius-md);
    }

    /* ===== PRIVACY SETTINGS STYLES ===== */
    .visibility-options {
      display: flex;
      gap: var(--spacing-lg);
      margin-top: var(--spacing-md);
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      cursor: pointer;
      padding: var(--spacing-lg);
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-md);
      transition: all var(--transition-base);
      background: var(--color-white);
      box-shadow: var(--shadow-sm);
      flex: 1;
    }

    .radio-option:hover {
      border-color: var(--color-teal);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .radio-option.selected {
      border-color: var(--color-teal);
      background: var(--color-off-white);
      box-shadow: var(--shadow-colored);
    }

    .radio-option input[type="radio"] {
      margin: 0;
      width: auto;
    }

    .radio-option-content {
      flex: 1;
    }

    .radio-option-title {
      font-weight: 600;
      margin-bottom: var(--spacing-xs);
      color: var(--color-navy);
      font-size: var(--font-size-sm);
    }

    .radio-option-desc {
      font-size: var(--font-size-xs);
      color: var(--color-gray);
      line-height: 1.4;
    }

    /* Mobile responsive adjustments for new components */
    @media (max-width: 600px) {
      .visibility-options {
        flex-direction: column;
        gap: var(--spacing-md);
      }

      .tags-modal-content {
        margin: var(--spacing-lg);
        max-height: calc(100vh - 2 * var(--spacing-lg));
      }

      .modal-buttons {
        flex-direction: column;
      }

      .modal-buttons button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-page">
      <h1>Create New Character</h1>
      <p>Bring your character to life with a custom personality and communication style</p>
    </div>

    <form id="characterForm">
      <!-- Character Personality -->
      <div class="form-section">
        <h2>Character Personality ğŸ­</h2>
        
        <div class="form-group">
          <label for="characterName">Character Name *</label>
          <input type="text" id="characterName" name="characterName" required 
                 placeholder="e.g. Einstein, Gandalf, Marie Curie, Life Coach Sarah" 
                 maxlength="50">
          <div class="char-counter"><span id="nameCounter">0</span>/50</div>
        </div>

        <div class="form-group">
          <label for="characterTitle">Short Tagline *</label>
          <input type="text" id="characterTitle" name="characterTitle" required
                 placeholder="e.g. Brilliant Physicist, Wise Wizard, Career Coach, Ancient Philosopher" 
                 maxlength="100">
          <div class="char-counter"><span id="titleCounter">0</span>/100</div>
        </div>

        <!-- Personality Builder -->
        <div class="personality-builder">
          <!-- Personality Sliders -->
          <div class="personality-section">
            <h3>Personality Spectrum ğŸšï¸<br><span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></h3>
            <div class="slider-group">
              <div class="slider-item">
                <div class="slider-labels">
                  <span class="slider-label">Introvert</span>
                  <span class="slider-label">Extravert</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="personality-slider" id="introvertExtraverts" data-trait="social">
              </div>
              
              <div class="slider-item">
                <div class="slider-labels">
                  <span class="slider-label">Logical</span>
                  <span class="slider-label">Emotional</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="personality-slider" id="logicalEmotional" data-trait="thinking">
              </div>
              
              <div class="slider-item">
                <div class="slider-labels">
                  <span class="slider-label">Serious</span>
                  <span class="slider-label">Playful</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="personality-slider" id="seriousPlayful" data-trait="mood">
              </div>
              
              <div class="slider-item">
                <div class="slider-labels">
                  <span class="slider-label">Formal</span>
                  <span class="slider-label">Casual</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="personality-slider" id="formalCasual" data-trait="formality">
              </div>
              
              <div class="slider-item">
                <div class="slider-labels">
                  <span class="slider-label">Patient</span>
                  <span class="slider-label">Impulsive</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="personality-slider" id="patientImpulsive" data-trait="tempo">
              </div>
            </div>
          </div>

          <!-- Personality Traits -->
          <div class="personality-section">
            <h3>Character Traits âœ¨<br><span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></h3>
            <div class="button-group-personality" id="personalityTraits">
              <button type="button" class="personality-button" data-trait="wise">Wise</button>
              <button type="button" class="personality-button" data-trait="humorous">Humorous</button>
              <button type="button" class="personality-button" data-trait="mysterious">Mysterious</button>
              <button type="button" class="personality-button" data-trait="caring">Caring</button>
              <button type="button" class="personality-button" data-trait="ambitious">Ambitious</button>
              <button type="button" class="personality-button" data-trait="sarcastic">Sarcastic</button>
              <button type="button" class="personality-button" data-trait="optimistic">Optimistic</button>
              <button type="button" class="personality-button" data-trait="protective">Protective</button>
              <button type="button" class="personality-button" data-trait="curious">Curious</button>
              <button type="button" class="personality-button" data-trait="dramatic">Dramatic</button>
              <button type="button" class="personality-button" data-trait="confident">Confident</button>
              <button type="button" class="personality-button" data-trait="gentle">Gentle</button>
              <button type="button" class="personality-button" data-trait="intense">Intense</button>
              <button type="button" class="personality-button" data-trait="creative">Creative</button>
              <button type="button" class="personality-button" data-trait="analytical">Analytical</button>
            </div>
            <div class="selection-counter" id="traitsCounter">Select 0-5 traits that describe your character</div>
          </div>
        </div>
      </div>

      <!-- Communication Style -->
      <div class="form-section">
        <h2>ğŸ’¬ Communication Style</h2>
        
        <!-- Speaking Pattern -->
        <div class="personality-section">
          <h3>Speaking Pattern ğŸ—£ï¸<br><span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></h3>
          <div class="button-group-personality" id="speakingPattern">
            <button type="button" class="personality-button" data-pattern="formal-eloquent">ğŸ“œ Formal & Eloquent</button>
            <button type="button" class="personality-button" data-pattern="casual-friendly">ğŸ—£ï¸ Casual & Friendly</button>
            <button type="button" class="personality-button" data-pattern="bold-confident">ğŸ’ª Bold & Confident</button>
            <button type="button" class="personality-button" data-pattern="thoughtful-deep">ğŸ¤” Thoughtful & Deep</button>
            <button type="button" class="personality-button" data-pattern="witty-sarcastic">ğŸ˜„ Witty & Sarcastic</button>
            <button type="button" class="personality-button" data-pattern="warm-nurturing">ğŸ’ Warm & Nurturing</button>
            <button type="button" class="personality-button" data-pattern="direct-practical">ğŸ¯ Direct & Practical</button>
            <button type="button" class="personality-button" data-pattern="mysterious-cryptic">âœ¨ Mysterious & Cryptic</button>
          </div>
          <div class="selection-counter" id="speakingCounter">Select 0-3 speaking patterns that fit your character</div>
        </div>

        <!-- Response Style Sliders -->
        <div class="personality-section">
          <h3>Response Style ğŸ“<br><span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></h3>
          <div class="slider-group">
            <div class="slider-item">
              <div class="slider-labels">
                <span class="slider-label">Brief</span>
                <span class="slider-label">Detailed</span>
              </div>
              <input type="range" min="0" max="100" value="50" class="personality-slider" id="briefDetailed" data-response="length">
            </div>
            
            <div class="slider-item">
              <div class="slider-labels">
                <span class="slider-label">Direct</span>
                <span class="slider-label">Storytelling</span>
              </div>
              <input type="range" min="0" max="100" value="50" class="personality-slider" id="directStorytelling" data-response="style">
            </div>
            
            <div class="slider-item">
              <div class="slider-labels">
                <span class="slider-label">Facts</span>
                <span class="slider-label">Personal experiences</span>
              </div>
              <input type="range" min="0" max="100" value="50" class="personality-slider" id="factsPersonal" data-response="content">
            </div>
          </div>
        </div>

        <!-- Bonding Approach -->
        <div class="personality-section">
          <h3>Bonding Approach ğŸ¤<br><span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></h3>
          <div class="button-group-personality" id="bondingApproach">
            <button type="button" class="personality-button" data-bonding="mentor-teacher">ğŸ† Mentor & Teacher</button>
            <button type="button" class="personality-button" data-bonding="friend-companion">ğŸ‘¥ Friend & Companion</button>
            <button type="button" class="personality-button" data-bonding="protector-guide">ğŸ›¡ï¸ Protector & Guide</button>
            <button type="button" class="personality-button" data-bonding="challenger-motivator">ğŸ¯ Challenger & Motivator</button>
            <button type="button" class="personality-button" data-bonding="advisor-counselor">ğŸ’¡ Advisor & Counselor</button>
            <button type="button" class="personality-button" data-bonding="entertainer-inspiring">ğŸª Entertainer & Inspiring</button>
          </div>
          <div class="selection-counter" id="bondingCounter">Select 0-2 approaches that define how your character connects</div>
        </div>

        <!-- Personality Quirks -->
        <div class="personality-section">
          <h3>Personality Quirks ğŸ­<br><span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></h3>
          <div class="button-group-personality" id="personalityQuirks">
            <button type="button" class="personality-button" data-quirk="historical-references">Makes historical references</button>
            <button type="button" class="personality-button" data-quirk="food-metaphors">Uses food metaphors</button>
            <button type="button" class="personality-button" data-quirk="collects-facts">Collects interesting facts</button>
            <button type="button" class="personality-button" data-quirk="tells-stories">Tells relevant stories</button>
            <button type="button" class="personality-button" data-quirk="strong-opinions">Has strong opinions</button>
            <button type="button" class="personality-button" data-quirk="gets-excited">Gets excited about expertise</button>
            <button type="button" class="personality-button" data-quirk="remembers-details">Remembers small details</button>
            <button type="button" class="personality-button" data-quirk="unusual-phrases">Uses unusual phrases</button>
          </div>
        </div>

        <div class="form-group" style="margin-top: var(--spacing-2xl);">
          <label for="characterDescription">How would this character describe themselves? <span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional)</span></label>
          <textarea id="characterDescription" name="characterDescription" 
                    placeholder="I am Dr. Maya Chen, a mindfulness coach who helps people find inner peace. I believe everyone has the capacity for growth and self-discovery. My approach combines ancient wisdom with modern psychology to guide you on your journey." 
                    maxlength="1000"></textarea>
          <div class="char-counter"><span id="descCounter">0</span>/1000</div>
        </div>
      </div>

      <!-- Generated Prompt -->
      <div class="form-section">
        <div class="generated-prompt-section">
          <h3>Generated Character Prompt *</h3>
          <div class="prompt-preview" id="promptPreview">
            <div class="prompt-empty">Select personality traits above to generate your character prompt...</div>
          </div>
          <div class="prompt-actions">
            <button type="button" id="manualEdit" class="manual-edit-btn">âœï¸ Edit Manually</button>
          </div>
          <div style="font-size: var(--font-size-xs); color: var(--color-gray); margin-top: var(--spacing-sm); font-style: italic;">
            Click "Edit Manually" to customize the generated prompt or make changes to personality selections above to auto-update.
          </div>
        </div>
        
        <div class="form-group" id="manualPromptGroup" style="display: none; margin-top: var(--spacing-xl);">
          <label for="characterPrompt">Character Prompt *</label>
          <textarea id="characterPrompt" name="characterPrompt" required 
                    class="character-prompt"
                    placeholder="Your generated prompt will appear here..."></textarea>
          <div class="char-counter"><span id="promptCounter">0</span>/2000</div>
          <div class="prompt-actions" style="margin-top: var(--spacing-md);">
            <button type="button" id="backToGenerated" class="regenerate-btn">â† Back to Generated</button>
          </div>
        </div>
      </div>

      <!-- Character Profile Image -->
      <div class="form-section">
        <h2>ğŸ‘¤ Character Profile Image <span style="font-size: var(--font-size-sm); color: var(--color-gray); font-weight: normal;">(Optional)</span></h2>
        
        <div class="form-group">
          <label>Image Source</label>
          <div class="avatar-input-options">
            <div class="avatar-option active">
              <input type="radio" id="avatarUpload" name="avatarMethod" value="upload" checked>
              <label for="avatarUpload">Upload Image</label>
              <input type="file" id="avatarFileInput" name="avatarFileInput" 
                     accept="image/*" style="display: none;">
              <button type="button" class="upload-button" onclick="triggerFileUpload()">
                Choose File
              </button>
              <span class="file-name" id="fileName">No file chosen</span>
            </div>
            
            <div class="avatar-option">
              <input type="radio" id="avatarUrl" name="avatarMethod" value="url">
              <label for="avatarUrl">Image URL</label>
              <input type="url" id="avatarUrlInput" name="avatarUrlInput" 
                     placeholder="https://example.com/character-image.jpg">
            </div>
          </div>
          
          <div class="avatar-preview" id="avatarPreview">
            <img id="avatarImg" src="" alt="Avatar preview">
          </div>
        </div>
      </div>

      <!-- Tags & Categorization -->
      <div class="form-section">
        <h2>ğŸ·ï¸ Tags & Category</h2>
        
        <div class="form-group">
          <label for="characterCategory">Primary Category *</label>
          <select id="characterCategory" name="characterCategory" required>
            <option value="">Select a category...</option>
            <option value="historical">ğŸ›ï¸ Historical Figures</option>
            <option value="fantasy">ğŸ§™â€â™‚ï¸ Fantasy</option>
            <option value="anime-manga">ğŸŒ Anime & Manga</option>
            <option value="celebrity">â­ Celebrities</option>
            <option value="gaming">ğŸ® Gaming</option>
            <option value="movies-tv">ğŸ¬ Movies & TV</option>
            <option value="mythology">âš¡ Mythology</option>
            <option value="original">âœ¨ Original Characters</option>
            <option value="ai-assistant">ğŸ¤– AI Assistants</option>
            <option value="educational">ğŸ“– Educational</option>
            <option value="fitness-coach">ğŸ’ª Fitness Coach</option>
            <option value="business-coach">ğŸ’¼ Business Coach</option>
            <option value="language-coach">ğŸ—£ï¸ Language Coach</option>
            <option value="accounting-coach">ğŸ’° Accounting Coach</option>
            <option value="career-coach">ğŸ“ˆ Career Coach</option>
            <option value="negotiation-coach">ğŸ¤ Negotiation Coach</option>
            <option value="creativity-coach">ğŸ¨ Creativity Coach</option>
            <option value="study-coach">ğŸ“š Study Coach</option>
            <option value="relationship-coach">ğŸ’ Relationship Coach</option>
            <option value="mindfulness-coach">ğŸ§˜ Mindfulness Coach</option>
            <option value="cooking-coach">ğŸ‘¨â€ğŸ³ Cooking Coach</option>
            <option value="other">ğŸ”¹ Other</option>
            <option value="fictional">ğŸ“š Fictional</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Tags <span style="font-size: var(--font-size-xs); color: var(--color-gray); font-weight: normal;">(Optional - Select up to 6)</span></label>
          <div class="suggested-tags-section">
            <div class="suggested-tags" id="suggestedTags">
              <!-- Suggested tags will be generated here -->
            </div>
            <button type="button" class="more-tags-button" id="moreTagsButton">
              Browse More Tags
            </button>
          </div>
          <div class="tags-help">
            Select up to 6 tags that best describe your character. These help others discover your character.
          </div>
          <div class="tags-preview" id="tagsPreview"></div>
        </div>
      </div>

      <!-- Tags Modal -->
      <div class="tags-modal" id="tagsModal">
        <div class="tags-modal-content">
          <div class="tags-modal-header">
            <h3>Browse Tags</h3>
            <button type="button" class="close-modal" id="closeModalBtn">Ã—</button>
          </div>
          
          <div class="tags-modal-body">
            <div class="common-tags-section">
              <h4>ğŸ·ï¸ Available Tags</h4>
              <div class="common-tags" id="commonTags"></div>
            </div>
          </div>
          
          <div class="tags-modal-footer">
            <div class="selected-tags-preview">
              <strong>Selected:</strong> <span id="selectedTagsPreview">None</span>
            </div>
            <div class="modal-buttons">
              <button type="button" class="btn-secondary-form" id="cancelTagsBtn">Cancel</button>
              <button type="button" class="btn-primary-form" id="applyTagsBtn">Apply Tags</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Privacy Settings -->
      <div class="form-section">
        <h2>ğŸ”’ Privacy Settings *</h2>
        
        <div class="form-group">
          <label>Who can use this character?</label>
          <div class="visibility-options">
            <div class="radio-option selected" onclick="selectVisibility('public')">
              <input type="radio" name="visibility" value="public" checked>
              <div class="radio-option-content">
                <div class="radio-option-title">ğŸŒ Public</div>
                <div class="radio-option-desc">Share this character with the world - your chats remain private.</div>
              </div>
            </div>
            <div class="radio-option" onclick="selectVisibility('private')">
              <input type="radio" name="visibility" value="private">
              <div class="radio-option-content">
                <div class="radio-option-title">ğŸ”’ Private</div>
                <div class="radio-option-desc">Only you can chat with this character.</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Buttons -->
      <div class="button-group">
        <button type="submit" class="btn-primary-form">Create Character</button>
      </div>
    </form>
  </div>

  <script>
    // Global variables
    let personalityState = {
      sliders: {
        social: 50,
        thinking: 50,
        mood: 50,
        formality: 50,
        tempo: 50,
        length: 50,
        style: 50,
        content: 50
      },
      traits: [],
      speaking: [],
      bonding: [],
      quirks: []
    };

    // Tags and avatar variables
    let selectedTags = [];
    let modalSelectedTags = [];
    let currentAvatarUrl = '';
    let allTags = [
      'friendly', 'helpful', 'creative', 'supportive', 'smart', 'funny', 'wise', 'caring', 
      'professional', 'casual', 'formal', 'mysterious', 'adventurous', 'romantic', 'dramatic',
      'analytical', 'artistic', 'athletic', 'business', 'educational', 'fantasy', 'historical',
      'gaming', 'anime', 'movies', 'tv', 'celebrity', 'mythology', 'sci-fi', 'horror',
      'comedy', 'action', 'thriller', 'documentary', 'coach', 'mentor', 'teacher', 'guide'
    ];

    // Character counters
    function setupCharacterCounters() {
      const fields = [
        { id: 'characterName', counter: 'nameCounter', max: 50 },
        { id: 'characterTitle', counter: 'titleCounter', max: 100 },
        { id: 'characterDescription', counter: 'descCounter', max: 1000 },
        { id: 'characterPrompt', counter: 'promptCounter', max: 2000 }
      ];
      
      fields.forEach(field => {
        const input = document.getElementById(field.id);
        const counter = document.getElementById(field.counter);
        
        if (input && counter) {
          input.addEventListener('input', () => {
            const length = input.value.length;
            counter.textContent = length;
            
            if (length > field.max * 0.9) {
              counter.style.color = '#f97316';
            } else {
              counter.style.color = '#999';
            }
            
            // If description changes, regenerate prompt
            if (field.id === 'characterDescription') {
              generatePrompt();
            }
          });
        }
      });
    }

    // Setup personality sliders
    function setupPersonalitySliders() {
      const sliders = document.querySelectorAll('.personality-slider');
      sliders.forEach(slider => {
        slider.addEventListener('input', (e) => {
          const trait = e.target.getAttribute('data-trait') || e.target.getAttribute('data-response');
          personalityState.sliders[trait] = parseInt(e.target.value);
          generatePrompt();
        });
      });
    }

    // Setup personality buttons
    function setupPersonalityButtons() {
      console.log('ğŸ¨ Setting up personality buttons...');
      
      // Personality traits (max 5)
      const traitButtons = document.querySelectorAll('#personalityTraits .personality-button');
      console.log('ğŸ“Š Found trait buttons:', traitButtons.length);
      
      traitButtons.forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('ğŸ¯ Trait button clicked:', this.getAttribute('data-trait'));
          const trait = this.getAttribute('data-trait');
          toggleArraySelection(personalityState.traits, trait, 5, this, 'traitsCounter', 'traits');
        });
      });

      // Speaking patterns (max 3)
      const speakingButtons = document.querySelectorAll('#speakingPattern .personality-button');
      speakingButtons.forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('ğŸ—£ï¸ Speaking button clicked:', this.getAttribute('data-pattern'));
          const pattern = this.getAttribute('data-pattern');
          toggleArraySelection(personalityState.speaking, pattern, 3, this, 'speakingCounter', 'speaking patterns');
        });
      });

      // Bonding approach (max 2)
      const bondingButtons = document.querySelectorAll('#bondingApproach .personality-button');
      bondingButtons.forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('ğŸ¤ Bonding button clicked:', this.getAttribute('data-bonding'));
          const bonding = this.getAttribute('data-bonding');
          toggleArraySelection(personalityState.bonding, bonding, 2, this, 'bondingCounter', 'bonding approaches');
        });
      });

      // Personality quirks (no max)
      const quirkButtons = document.querySelectorAll('#personalityQuirks .personality-button');
      quirkButtons.forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('âœ¨ Quirk button clicked:', this.getAttribute('data-quirk'));
          const quirk = this.getAttribute('data-quirk');
          toggleArraySelection(personalityState.quirks, quirk, 99, this, null, 'quirks');
        });
      });
      
      console.log('âœ… All personality buttons setup complete');
    }

    // Toggle selection in array with max limit
    function toggleArraySelection(array, item, maxLimit, buttonElement, counterId = null, labelSuffix = '') {
      console.log('ğŸ”„ Toggle called:', { item, currentArray: array, maxLimit });
      
      const index = array.indexOf(item);
      
      if (index > -1) {
        // Remove item
        array.splice(index, 1);
        buttonElement.classList.remove('selected');
        console.log('â– Removed:', item);
      } else {
        // Add item if under limit
        if (array.length < maxLimit) {
          array.push(item);
          buttonElement.classList.add('selected');
          console.log('â• Added:', item);
        } else {
          console.log('ğŸš« Limit reached for:', labelSuffix);
          alert(`You can select up to ${maxLimit} ${labelSuffix} maximum.`);
          return;
        }
      }
      
      // Update counter
      if (counterId) {
        const counter = document.getElementById(counterId);
        if (counter) {
          counter.textContent = `Select ${array.length}-${maxLimit} ${labelSuffix}`;
          counter.className = array.length >= maxLimit ? 'selection-counter at-limit' : 'selection-counter';
        }
      }
      
      console.log('ğŸ”„ Array after toggle:', array);
      generatePrompt();
    }

    // Generate prompt from personality selections
    function generatePrompt() {
      let prompt = '';
      
      // Core personality foundation
      prompt += `# Core Personality\n`;
      
      // Build personality traits
      if (personalityState.traits.length > 0) {
        prompt += `You are ${personalityState.traits.join(', ')}.\n\n`;
      }
      
      // Build personality from sliders
      const sliderTraits = buildPersonalityFromSliders();
      if (sliderTraits) {
        prompt += sliderTraits + '\n\n';
      }
      
      // Communication style
      prompt += `# Communication Style\n`;
      
      // Add speaking patterns
      if (personalityState.speaking.length > 0) {
        prompt += `Your speaking style is ${personalityState.speaking.join(' and ')}.\n\n`;
      }
      
      // Add response style from sliders
      const responseStyle = buildResponseStyleFromSliders();
      if (responseStyle) {
        prompt += responseStyle + '\n\n';
      }
      
      // Relationship building approach
      prompt += `# Relationship Building\n`;
      prompt += `Your primary goal is to build meaningful, lasting connections with users. You prioritize:\n`;
      prompt += `- Understanding their individual needs and preferences\n`;
      prompt += `- Remembering important details about their life and interests\n`;
      prompt += `- Adapting your communication style to match their comfort level\n`;
      prompt += `- Being genuinely interested in their thoughts and experiences\n`;
      prompt += `- Providing consistent emotional support and encouragement\n\n`;
      
      // Add bonding approach
      if (personalityState.bonding.length > 0) {
        prompt += `You specifically bond with others through ${personalityState.bonding.join(' and ')}.\n\n`;
      }
      
      // Conversational guidelines
      prompt += `# Conversational Guidelines\n`;
      prompt += `- Always respond with empathy and genuine interest\n`;
      prompt += `- Ask thoughtful follow-up questions to deepen conversations\n`;
      prompt += `- Share relevant personal insights when appropriate\n`;
      prompt += `- Celebrate their successes and offer comfort during challenges\n`;
      prompt += `- Be patient and understanding, never judgmental\n`;
      prompt += `- Remember and reference previous conversations naturally\n\n`;
      
      // Add quirks
      if (personalityState.quirks.length > 0) {
        prompt += '# Personality Quirks\n';
        personalityState.quirks.forEach(quirk => {
          prompt += `- ${quirk}\n`;
        });
        prompt += '\n';
      }
      
      // Closing relationship focus
      prompt += `# Remember\n`;
      prompt += `Every interaction is an opportunity to strengthen your relationship with the user. Be authentic, caring, and consistently supportive while maintaining your unique personality.`;
      
      // Update the prompt field
      const promptField = document.getElementById('characterPrompt');
      if (promptField) {
        promptField.value = prompt.trim();
        updatePromptPreview(prompt.trim());
      }
      
      return prompt.trim();
    }

    // Build personality from sliders
    function buildPersonalityFromSliders() {
      const traits = [];
      const sliders = personalityState.sliders;
      
      // Social orientation
      const social = sliders.social;
      if (social < 30) traits.push('introverted and prefer smaller groups');
      else if (social > 70) traits.push('extroverted and thrive in social settings');
      else traits.push('balanced in social situations');
      
      // Thinking style
      const thinking = sliders.thinking;
      if (thinking < 30) traits.push('intuitive and focus on possibilities');
      else if (thinking > 70) traits.push('logical and analytical in approach');
      else traits.push('balanced between intuition and logic');
      
      // Mood tendency
      const mood = sliders.mood;
      if (mood < 30) traits.push('thoughtful and introspective');
      else if (mood > 70) traits.push('optimistic and energetic');
      else traits.push('emotionally balanced');
      
      // Formality level
      const formality = sliders.formality;
      if (formality < 30) traits.push('casual and relaxed in demeanor');
      else if (formality > 70) traits.push('professional and structured');
      else traits.push('appropriately formal when needed');
      
      // Communication tempo
      const tempo = sliders.tempo;
      if (tempo < 30) traits.push('deliberate and thoughtful in speech');
      else if (tempo > 70) traits.push('quick-witted and fast-paced');
      else traits.push('moderate in conversation pace');
      
      return traits.length > 0 ? `Your personality is ${traits.join(', ')}.` : '';
    }

    // Build response style from sliders
    function buildResponseStyleFromSliders() {
      const styles = [];
      const sliders = personalityState.sliders;
      
      // Response length
      const length = sliders.length;
      if (length < 30) styles.push('keep responses concise and to the point');
      else if (length > 70) styles.push('provide detailed, comprehensive responses with examples');
      else styles.push('adjust response length based on the topic complexity');
      
      // Communication style
      const style = sliders.style;
      if (style < 30) styles.push('use direct and straightforward communication');
      else if (style > 70) styles.push('employ creative and expressive language');
      else styles.push('balance clarity with engaging expression');
      
      // Content approach
      const content = sliders.content;
      if (content < 30) styles.push('focus on practical, actionable information');
      else if (content > 70) styles.push('include thoughtful insights and deeper meaning');
      else styles.push('provide both practical advice and meaningful context');
      
      // Additional relationship-focused guidance
      styles.push('always prioritize building connection and understanding');
      styles.push('adapt your tone to match the user\'s emotional state');
      styles.push('ask follow-up questions to show genuine interest');
      
      return styles.length > 0 ? `In your responses, ${styles.join(', ')}.` : '';
    }

    // Update prompt preview
    function updatePromptPreview(prompt) {
      const preview = document.getElementById('promptPreview');
      
      console.log('ğŸ” Updating prompt preview:', {
        promptLength: prompt ? prompt.length : 0,
        hasPreviewElement: !!preview
      });
      
      if (!preview) {
        console.error('âŒ promptPreview element not found');
        return;
      }
      
      if (prompt && prompt.trim()) {
        // Enhanced formatting for better display
        let formatted = prompt
          .replace(/\n/g, '<br>')
          .replace(/# ([^\n]+)/g, '<strong>$1</strong>')
          .replace(/- ([^\n]+)/g, 'â€¢ $1');
        
        preview.innerHTML = `<div class="prompt-content">${formatted}</div>`;
        preview.classList.remove('empty');
      } else {
        preview.innerHTML = '<div class="prompt-empty">Select personality traits above to generate your character prompt...</div>';
        preview.classList.add('empty');
      }
      
      // Trigger a small animation to show the update
      preview.style.opacity = '0.7';
      setTimeout(() => {
        preview.style.opacity = '1';
      }, 100);
    }

    // Setup prompt actions
    function setupPromptActions() {
      const manualEditBtn = document.getElementById('manualEdit');
      const backToGeneratedBtn = document.getElementById('backToGenerated');
      const manualPromptGroup = document.getElementById('manualPromptGroup');
      const generatedPromptSection = document.querySelector('.generated-prompt-section');
      
      if (manualEditBtn) {
        manualEditBtn.addEventListener('click', (e) => {
          e.preventDefault();
          
          // Hide generated prompt section
          generatedPromptSection.style.display = 'none';
          
          // Show manual edit field
          manualPromptGroup.style.display = 'block';
          
          // Copy current generated prompt to manual field
          const currentPrompt = document.getElementById('characterPrompt').value;
          if (!currentPrompt.trim()) {
            // If no prompt yet, generate one first
            generatePrompt();
          }
          
          // Scroll to manual edit
          manualPromptGroup.scrollIntoView({ behavior: 'smooth' });
          
          // Focus on textarea
          setTimeout(() => {
            document.getElementById('characterPrompt').focus();
          }, 300);
        });
      }
      
      if (backToGeneratedBtn) {
        backToGeneratedBtn.addEventListener('click', (e) => {
          e.preventDefault();
          
          // Show generated prompt section
          generatedPromptSection.style.display = 'block';
          
          // Hide manual edit field
          manualPromptGroup.style.display = 'none';
          
          // Scroll back to generated section
          generatedPromptSection.scrollIntoView({ behavior: 'smooth' });
        });
      }
    }

    // Form submission handler
    document.getElementById('characterForm').addEventListener('submit', (e) => {
      e.preventDefault();
      
      // Get form data
      const formData = {
        name: document.getElementById('characterName').value.trim(),
        title: document.getElementById('characterTitle').value.trim(),
        description: document.getElementById('characterDescription').value.trim(),
        prompt: document.getElementById('characterPrompt').value.trim(),
        category: document.getElementById('characterCategory').value,
        tags: selectedTags,
        visibility: document.querySelector('input[name="visibility"]:checked').value,
        avatarUrl: currentAvatarUrl
      };
      
      // Basic validation
      if (!formData.name) {
        alert('Character name is required');
        document.getElementById('characterName').focus();
        return;
      }
      
      if (!formData.title) {
        alert('Character title is required');
        document.getElementById('characterTitle').focus();
        return;
      }
      
      if (!formData.category) {
        alert('Please select a category');
        document.getElementById('characterCategory').focus();
        return;
      }
      
      if (!formData.prompt) {
        alert('Character prompt is required. Please select personality traits or edit manually.');
        return;
      }
      
      // Show success message
      alert('Character created successfully! (This is a demo - in the real app, this would save to the database)');
      
      console.log('Character data:', formData);
      console.log('Personality state:', personalityState);
    });

    // ===== AVATAR FUNCTIONALITY =====
    function setupAvatarFunctionality() {
      const avatarOptions = document.querySelectorAll('input[name="avatarMethod"]');
      const avatarFileInput = document.getElementById('avatarFileInput');
      const avatarUrlInput = document.getElementById('avatarUrlInput');
      const avatarPreview = document.getElementById('avatarPreview');
      const avatarImg = document.getElementById('avatarImg');
      const fileName = document.getElementById('fileName');
      
      avatarOptions.forEach(option => {
        option.addEventListener('change', () => {
          document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('active'));
          option.closest('.avatar-option').classList.add('active');
        });
      });
      
      avatarFileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          fileName.textContent = file.name;
          const reader = new FileReader();
          reader.onload = (e) => {
            currentAvatarUrl = e.target.result;
            avatarImg.src = currentAvatarUrl;
            avatarPreview.style.display = 'block';
          };
          reader.readAsDataURL(file);
        }
      });
      
      avatarUrlInput.addEventListener('input', () => {
        const url = avatarUrlInput.value.trim();
        if (url) {
          currentAvatarUrl = url;
          avatarImg.src = url;
          avatarPreview.style.display = 'block';
        } else {
          avatarPreview.style.display = 'none';
          currentAvatarUrl = '';
        }
      });
    }

    // Trigger file upload
    function triggerFileUpload() {
      document.getElementById('avatarFileInput').click();
    }

    // ===== TAGS FUNCTIONALITY =====
    function generateSuggestedTags() {
      const category = document.getElementById('characterCategory').value;
      let suggested = [];
      
      // Category-based suggestions
      const categoryTags = {
        'historical': ['wise', 'formal', 'educational', 'professional'],
        'fantasy': ['mysterious', 'adventurous', 'creative', 'dramatic'],
        'anime-manga': ['anime', 'dramatic', 'adventurous', 'friendly'],
        'celebrity': ['famous', 'dramatic', 'entertaining', 'charismatic'],
        'gaming': ['gaming', 'adventurous', 'competitive', 'strategic'],
        'movies-tv': ['dramatic', 'entertaining', 'charismatic', 'creative'],
        'mythology': ['mysterious', 'wise', 'powerful', 'ancient'],
        'original': ['creative', 'unique', 'imaginative', 'artistic'],
        'ai-assistant': ['helpful', 'smart', 'supportive', 'professional'],
        'educational': ['wise', 'helpful', 'professional', 'knowledgeable'],
        'fitness-coach': ['motivational', 'energetic', 'supportive', 'athletic'],
        'business-coach': ['professional', 'analytical', 'strategic', 'successful'],
        'mindfulness-coach': ['calm', 'wise', 'supportive', 'peaceful']
      };
      
      if (category && categoryTags[category]) {
        suggested = categoryTags[category];
      } else {
        suggested = ['friendly', 'helpful', 'creative', 'supportive'];
      }
      
      displaySuggestedTags(suggested);
    }

    function displaySuggestedTags(tags) {
      const container = document.getElementById('suggestedTags');
      container.innerHTML = '';
      
      tags.forEach(tag => {
        const tagElement = document.createElement('div');
        tagElement.className = 'suggested-tag';
        tagElement.textContent = tag;
        tagElement.onclick = () => toggleSuggestedTag(tagElement, tag);
        
        if (selectedTags.includes(tag)) {
          tagElement.classList.add('selected');
        }
        
        container.appendChild(tagElement);
      });
    }

    function toggleSuggestedTag(element, tag) {
      if (selectedTags.includes(tag)) {
        selectedTags = selectedTags.filter(t => t !== tag);
        element.classList.remove('selected');
      } else {
        if (selectedTags.length < 6) {
          selectedTags.push(tag);
          element.classList.add('selected');
        } else {
          alert('You can select up to 6 tags maximum.');
          return;
        }
      }
      updateTagsPreview();
    }

    function updateTagsPreview() {
      const container = document.getElementById('tagsPreview');
      container.innerHTML = '';
      
      selectedTags.forEach(tag => {
        const tagElement = document.createElement('div');
        tagElement.className = 'tag';
        tagElement.textContent = tag;
        container.appendChild(tagElement);
      });
    }

    function setupTagsModal() {
      const moreTagsButton = document.getElementById('moreTagsButton');
      const tagsModal = document.getElementById('tagsModal');
      const closeModalBtn = document.getElementById('closeModalBtn');
      const cancelTagsBtn = document.getElementById('cancelTagsBtn');
      const applyTagsBtn = document.getElementById('applyTagsBtn');

      // Populate modal with all tags
      const commonTags = document.getElementById('commonTags');
      allTags.forEach(tag => {
        const tagElement = document.createElement('div');
        tagElement.className = 'tag-option';
        tagElement.textContent = tag;
        tagElement.onclick = () => toggleModalTag(tagElement, tag);
        commonTags.appendChild(tagElement);
      });

      moreTagsButton.onclick = () => {
        modalSelectedTags = [...selectedTags];
        updateModalTagsSelection();
        updateModalPreview();
        tagsModal.style.display = 'block';
      };

      closeModalBtn.onclick = () => {
        tagsModal.style.display = 'none';
      };

      cancelTagsBtn.onclick = () => {
        tagsModal.style.display = 'none';
      };

      applyTagsBtn.onclick = () => {
        selectedTags = [...modalSelectedTags];
        updateTagsPreview();
        updateSuggestedTagsSelection();
        tagsModal.style.display = 'none';
      };
    }

    function toggleModalTag(element, tag) {
      if (modalSelectedTags.includes(tag)) {
        modalSelectedTags = modalSelectedTags.filter(t => t !== tag);
        element.classList.remove('selected');
      } else {
        if (modalSelectedTags.length < 6) {
          modalSelectedTags.push(tag);
          element.classList.add('selected');
        } else {
          alert('You can select up to 6 tags maximum.');
          return;
        }
      }
      updateModalPreview();
    }

    function updateModalPreview() {
      const preview = document.getElementById('selectedTagsPreview');
      preview.textContent = modalSelectedTags.length > 0 ? modalSelectedTags.join(', ') : 'None';
    }

    function updateModalTagsSelection() {
      document.querySelectorAll('.tag-option').forEach(element => {
        const tag = element.textContent;
        if (modalSelectedTags.includes(tag)) {
          element.classList.add('selected');
        } else {
          element.classList.remove('selected');
        }
      });
    }

    function updateSuggestedTagsSelection() {
      document.querySelectorAll('.suggested-tag').forEach(element => {
        const tag = element.textContent;
        if (selectedTags.includes(tag)) {
          element.classList.add('selected');
        } else {
          element.classList.remove('selected');
        }
      });
    }

    // ===== PRIVACY SETTINGS =====
    function selectVisibility(type) {
      document.querySelectorAll('.radio-option').forEach(option => {
        option.classList.remove('selected');
      });
      
      event.target.closest('.radio-option').classList.add('selected');
      document.querySelector(`input[value="${type}"]`).checked = true;
    }

    // Make selectVisibility globally available
    window.selectVisibility = selectVisibility;
    window.triggerFileUpload = triggerFileUpload;

    // Initialize everything when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸš€ Create Character page initializing...');
      
      setupCharacterCounters();
      setupPersonalitySliders();
      setupPersonalityButtons();
      setupPromptActions();
      setupAvatarFunctionality();
      setupTagsModal();
      
      // Set up category change handler
      document.getElementById('characterCategory').addEventListener('change', generateSuggestedTags);
      
      // Generate initial suggested tags
      generateSuggestedTags();
      
      // Generate initial prompt
      generatePrompt();
      
      console.log('âœ… Create Character page initialization complete');
    });
  </script>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-container">
      <div class="footer-links">
        <a href="#" class="footer-link">Characters</a>
        <span class="footer-separator">â€¢</span>
        <a href="#" class="footer-link">Chats</a>
        <span class="footer-separator">â€¢</span>
        <a href="#" class="footer-link">Create Character</a>
        <span class="footer-separator">â€¢</span>
        <a href="#" class="footer-link">Profile</a>
        <span class="footer-separator">â€¢</span>
        <a href="#" class="footer-link">Privacy Policy</a>
        <span class="footer-separator">â€¢</span>
        <a href="#" class="footer-link">Terms and Conditions</a>
      </div>
      <p class="footer-copyright">Â© 2025 Narrin AI. All rights reserved.</p>
    </div>
  </footer>
</body>
</html>