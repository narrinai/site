<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mijn Profiel</title>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #ffffff;
      pointer-events: auto;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      -webkit-overflow-scrolling: touch;
    }

    .profile-container {
      max-width: 700px;
      margin: 0 auto;
      background: #f5f5f5;
      padding: 20px;
      border-radius: 10px;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 16px;
    }

    .profile-item {
      font-size: 16px;
      margin-bottom: 12px;
    }

    .label {
      font-weight: bold;
    }

    #upgrade-btn {
      display: inline-block;
      margin-top: 20px;
      padding: 12px 24px;
      background-color: #000;
      color: #fff;
      text-decoration: none;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
      touch-action: manipulation;
    }

    #error {
      color: red;
      margin-top: 16px;
    }

    @media (max-width: 600px) {
      body {
        padding: 16px;
      }
      .profile-container {
        padding: 16px;
      }
      h1 {
        font-size: 20px;
      }
      .profile-item {
        font-size: 15px;
      }
      #upgrade-btn {
        width: 100%;
        padding: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="profile-container">
    <h1>Mijn Profiel</h1>
    <div id="profile">
      <div class="profile-item"><span class="label">E-mail:</span> <span id="email">...</span></div>
      <div class="profile-item"><span class="label">Plan:</span> <span id="plan">...</span></div>
      <div class="profile-item"><span class="label">Verbruik:</span> <span id="usage">...</span>/<span id="quota">...</span> chats</div>
      <button id="upgrade-btn" onclick="handleUpgrade()">Upgrade naar Pro</button>
      <div id="error" style="display:none;"></div>
    </div>
  </div>

  <script>
    async function loadProfile() {
      const token = localStorage.getItem('user_token');
      const email = localStorage.getItem('user_email');
      const uid   = localStorage.getItem('user_uid');

      if (!token || !email || !uid) {
        document.getElementById('error').textContent = 'Niet ingelogd.';
        document.getElementById('error').style.display = 'block';
        return;
      }

      try {
        const response = await fetch('https://hook.make.com/get-user-info', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_email: email,
            user_uid:   uid,
            user_token: token
          })
        });
        if (!response.ok) {
          throw new Error('Fout bij laden: ' + response.status);
        }
        const data = await response.json();
        document.getElementById('email').textContent = data.email;
        document.getElementById('plan').textContent = data.plan;
        document.getElementById('usage').textContent = data.usage;
        document.getElementById('quota').textContent = data.quota;
      } catch (err) {
        document.getElementById('error').textContent = err.message;
        document.getElementById('error').style.display = 'block';
      }
    }

    function handleUpgrade() {
      window.location.href = '/checkout?plan=pro';
    }

    window.addEventListener('DOMContentLoaded', loadProfile);
  </script>
</body>
</html>
